
// std
#include <iostream>
#include <vector>

// opencv
#include <opencv2/core.hpp>
#include <opencv2/imgproc.hpp>
#include <opencv2/highgui.hpp>

// project
#include "patchmatch.hpp"
#include "gain.hpp"
#include "terrainopt.hpp"
#include "terrain.hpp"
#include "opencv_util.hpp"


using namespace cv;
using namespace std;






void testApprearanceSpace() {

	//gain::terrain test_terrain = gain::terrainReadImage("work/res/mount_jackson.png", 0, 255, 1);

	//// Appearance-space
	//Mat reduced = gain::appearanceSpace<4>(test_terrain.heightmap);

	//Mat ind[4];
	//split(reduced, ind);

	//imwrite(util::stringf("output/appearance_0.png"), gain::heightmapToImage(ind[0]));
	//imwrite(util::stringf("output/appearance_1.png"), gain::heightmapToImage(ind[1]));
	//imwrite(util::stringf("output/appearance_2.png"), gain::heightmapToImage(ind[2]));
	//imwrite(util::stringf("output/appearance_3.png"), gain::heightmapToImage(ind[3]));
}





void testK2Patchmatch() {
	gain::terrain test_terrain = gain::terrainReadImage("work/res/mount_jackson.png", 0, 255, 1);
	//// K=2 Patchmatch
	//Mat nnf = k2Patchmatch(testimage, testimage, 5, 4);

	//// convert offset coordinates to color image
	//Mat nnf_img_k1(nnf.rows, nnf.cols, CV_8UC3, Scalar(0, 0, 0));
	//Mat nnf_img_k2(nnf.rows, nnf.cols, CV_8UC3, Scalar(0, 0, 0));
	//for (int r = 0; r < nnf.rows; r++) {
	//	auto in_row = nnf.ptr<Vec<Vec2f, 2>>(r);
	//	auto out_row_k1 = nnf_img_k1.ptr<Vec3b>(r);
	//	auto out_row_k2 = nnf_img_k2.ptr<Vec3b>(r);
	//	for (int c = 0; c < nnf.cols; c++) {
	//		out_row_k1[c][2] = int((255.0 * in_row[c][0][0]) / testimage.cols); // cols -> r
	//		out_row_k1[c][1] = int((255.0 * in_row[c][0][1]) / testimage.rows); // rows -> g

	//		out_row_k2[c][2] = int((255.0 * in_row[c][1][0]) / testimage.cols); // cols -> r
	//		out_row_k2[c][1] = int((255.0 * in_row[c][1][1]) / testimage.rows); // rows -> g
	//	}
	//}

	//imwrite("output/NNF_k1.png", nnf_img_k1);
	//imwrite("output/NNF_k2.png", nnf_img_k2);
}




void testSynthesis() {

	// input terrain
	//gain::terrain test_terrain = gain::terrainReadImage("work/res/mount_jackson.png", 0, 255, 1);
	//gain::terrain test_terrain = gain::terrainReadTIFF("work/res/mt_fuji_n035e138.tif");
	//gain::terrain test_terrain = gain::terrainReadTIFF("work/res/mount_jackson_n39_w107_3arc.tif");
	//gain::terrain test_terrain = gain::terrainReadTIFF("work/res/southern_alps_s045e169.tif");
	gain::terrain test_terrain = gain::terrainReadASC("output/source.asc");

	// parameters
	gain::synthesis_params params;
	//params.randomInit = true;
	params.synthesisSize = Size(1024, 1024);
	params.exampleLevels = 7;
	params.synthesisLevels = 9;


	double low, high;
	minMaxIdx(test_terrain.heightmap, &low, &high);

	//// random constraints test
	//for (int i = 0; i < 20; i++) {
	//	params.pointConstraints.push_back(gain::point_constraint{
	//		Vec2f(util::random<float>(0, 512), util::random<float>(0, 512)),
	//		util::random<float>(low + (high - low)/2, high), util::random<float>(16, 32)
	//	});
	//}


	//params.curveConstraints.push_back(gain::curve_constraint{ {{91.3761,372.548},{93.37,372.948},{97.2273,373.682},{103.055,374.703},{110.46,375.85},{118.968,376.96},{128.15,377.913},{137.656,378.642},{147.222,379.131},{156.655,379.395},{165.814,379.467},{174.587,379.377},{182.885,379.148},{190.649,378.795},{197.856,378.326},{204.529,377.747},{210.728,377.071},{216.547,376.323},{222.095,375.544},{227.486,374.788},{232.813,374.116},{238.142,373.583},{243.499,373.231},{248.869,373.082},{254.213,373.141},{259.475,373.404},{264.607,373.868},{269.584,374.536},{274.418,375.417},{279.165,376.523},{283.91,377.852},{288.758,379.391},{293.8,381.106},{299.093,382.956},{304.648,384.9},{310.431,386.898},{316.376,388.92},{322.405,390.931},{328.445,392.894},{334.44,394.769},{340.352,396.523},{346.162,398.138},{351.856,399.623},{357.418,401.012},{362.823,402.357},{368.031,403.717},{373.002,405.147},{377.704,406.684},{382.136,408.354},{386.339,410.165},{390.39,412.118},{394.393,414.208},{398.451,416.422},{402.649,418.734},{407.036,421.109},{411.627,423.497},{416.405,425.841},{421.335,428.08},{426.378,430.166},{431.494,432.064},{436.652,433.762},{441.821,435.266},{446.964,436.597},{452.033,437.791},{456.965,438.897},{461.683,439.981},{466.11,441.123},{470.187,442.42},{473.891,443.967},{477.252,445.846},{480.35,448.105},{483.302,450.739},{486.241,453.689},{489.289,456.849},{492.535,460.086},{496.031,463.268},{499.786,466.287},{503.788,469.073},{508.007,471.596},{512.409,473.862},{516.953,475.907},{521.591,477.784},{526.254,479.562},{530.856,481.323},{535.299,483.163},{539.487,485.193},{543.356,487.526},{546.886,490.267},{550.11,493.489},{553.105,497.209},{555.964,501.384},{558.775,505.913},{561.599,510.656},{564.463,515.471},{567.365,520.232},{570.294,524.849},{573.236,529.27},{576.192,533.467},{579.171,537.428},{582.191,541.15},{585.266,544.642},{588.398,547.932},{591.564,551.071},{594.725,554.136},{597.825,557.216},{600.805,560.395},{603.607,563.739},{606.176,567.275},{608.455,570.996},{610.373,574.856},{611.843,578.782},{612.762,582.691},{613.029,586.509},{612.573,590.193},{611.389,593.744},{609.561,597.212},{607.275,600.689},{604.791,604.286},{602.402,608.112},{600.373,612.246},{598.887,616.72},{598.013,621.523},{597.709,626.604},{597.84,631.891},{598.22,637.303},{598.656,642.762},{598.977,648.186},{599.053,653.489},{598.793,658.573},{598.138,663.335},{597.046,667.681},{595.483,671.532},{593.42,674.841},{590.835,677.589},{587.73,679.776},{584.132,681.412},{580.106,682.513},{575.747,683.092},{571.17,683.176},{566.496,682.806},{561.829,682.044},{557.247,680.977},{552.791,679.701},{548.452,678.319},{544.18,676.928},{539.886,675.611},{535.469,674.439},{530.841,673.473},{525.963,672.781},{520.862,672.438},{515.636,672.535},{510.437,673.172},{505.442,674.441},{500.819,676.41},{496.691,679.102},{493.122,682.484},{490.102,686.469},{487.556,690.925},{485.362,695.695},{483.373,700.618},{481.438,705.531},{479.426,710.29},{477.232,714.762},{474.786,718.837},{472.045,722.425},{468.983,725.467},{465.583,727.93},{461.826,729.811},{457.699,731.135},{453.201,731.952},{448.357,732.327},{443.218,732.34},{437.863,732.079},{432.376,731.639},{426.835,731.112},{421.3,730.594},{415.814,730.172},{410.41,729.925},{405.114,729.917},{399.946,730.195},{394.903,730.787},{389.94,731.701},{384.962,732.93},{379.824,734.455},{374.362,736.248},{368.436,738.273},{361.978,740.478},{355.014,742.794},{347.667,745.14},{340.126,747.427},{332.601,749.572},{325.277,751.509},{318.286,753.194},{311.702,754.612},{305.567,755.769},{299.928,756.687},{294.877,757.397},{290.562,757.928},{287.196,758.302},{284.973,758.531},{283.823,758.645},},{{0, 3377.68, -4.18039, 1.67105, 16, 16, },{29, 3573.93, 3.97342, -11.1513, 16, 16, },{50, 3655.94, 5.54095, -11.519, 16, 16, },{69, 3879.79, -16.3548, -0.967102, 16, 16, },{87, 3900.51, -15.14, -9.39761, 16, 16, },{114, 3632.17, -15.3104, 18.2945, 16, 16, },{132, 3695.66, -5.74127, -15.905, 16, 16, },{146, 3444.18, -1.71573, -8.86359, 16, 16, },{167, 3417.26, -5.07117, -9.02252, 16, 16, },{183, 3246.1, -8.67111, -7.7168, 16, 16, },{200, 3079.38, -6.7041, -6.84225, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{479.893,411.778},{479.556,410.449},{478.911,407.871},{477.947,403.965},{476.742,398.994},{475.376,393.296},{473.907,387.202},{472.365,381.017},{470.74,374.991},{468.995,369.313},{467.072,364.107},{464.919,359.432},{462.506,355.281},{459.849,351.586},{457.014,348.224},{454.122,345.034},{451.319,341.845},{448.753,338.504},{446.544,334.906},{444.759,330.997},{443.408,326.775},{442.453,322.262},{441.823,317.479},{441.436,312.432},{441.214,307.113},{441.095,301.514},{441.031,295.65},{440.989,289.566},{440.943,283.336},{440.869,277.046},{440.738,270.776},{440.517,264.585},{440.162,258.514},{439.63,252.586},{438.877,246.816},{437.873,241.219},{436.605,235.802},{435.089,230.573},{433.363,225.531},{431.49,220.674},{429.544,215.994},{427.601,211.482},{425.73,207.123},{423.982,202.891},{422.386,198.743},{420.955,194.619},{419.688,190.45},{418.584,186.165},{417.657,181.711},{416.947,177.064},{416.527,172.236},{416.489,167.271},{416.93,162.232},{417.916,157.182},{419.455,152.162},{421.479,147.183},{423.85,142.222},{426.372,137.24},{428.839,132.201},{431.066,127.092},{432.929,121.928},{434.376,116.745},{435.426,111.581},{436.148,106.459},{436.646,101.379},{437.038,96.3225},{437.449,91.2682},{438.012,86.2145},{438.859,81.1926},{440.121,76.2714},{441.908,71.5502},{444.287,67.1403},{447.257,63.1444},{450.732,59.6391},{454.529,56.6673},{458.379,54.2418},{461.952,52.3567},{464.889,51.0033},{466.888,50.1651},{467.939,49.75},},{{0, 3803.17, 0.123413, -14.0104, 16, 16, },{23, 3819.68, -16.8332, 1.10568, 16, 16, },{46, 3801.05, -14.4999, -7.1261, 16, 16, },{64, 3440.92, -1.71939, -1.6731, 16, 16, },{79, 3398.42, 2.95303, -9.78271, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{402.05,319.319},{401.138,319.105},{399.412,318.65},{396.898,317.864},{393.867,316.685},{390.623,315.058},{387.428,312.94},{384.48,310.311},{381.896,307.181},{379.715,303.582},{377.908,299.56},{376.39,295.162},{375.036,290.42},{373.707,285.347},{372.268,279.948},{370.613,274.238},{368.679,268.264},{366.445,262.118},{363.933,255.942},{361.19,249.897},{358.275,244.142},{355.25,238.798},{352.177,233.927},{349.115,229.527},{346.129,225.536},{343.285,221.845},{340.645,218.316},{338.258,214.801},{336.15,211.157},{334.318,207.27},{332.732,203.069},{331.339,198.54},{330.075,193.721},{328.861,188.693},{327.609,183.562},{326.227,178.438},{324.628,173.418},{322.751,168.57},{320.583,163.926},{318.173,159.483},{315.628,155.2},{313.092,151.011},{310.721,146.839},{308.651,142.604},{306.979,138.233},{305.753,133.661},{304.979,128.843},{304.632,123.755},{304.668,118.406},{305.04,112.839},{305.702,107.129},{306.613,101.364},{307.735,95.6304},{309.027,90.0082},{310.439,84.5677},{311.909,79.3839},{313.359,74.5517},{314.701,70.1992},{315.851,66.4873},{316.735,63.6055},{317.305,61.7134},{317.594,60.7396},},{{0, 3850.58, -11.4682, -14.4021, 16, 16, },{13, 3728.52, -7.10229, 9.12131, 16, 16, },{29, 3674.84, -12.966, 9.15173, 16, 16, },{45, 3386.63, -2.54074, 4.08801, 16, 16, },{61, 3262.47, -0.0911255, -2.85098, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{318.409,285.135},{317.283,284.239},{315.11,282.517},{311.839,279.947},{307.696,276.743},{302.952,273.17},{297.843,269.476},{292.568,265.876},{287.279,262.53},{282.091,259.539},{277.09,256.943},{272.334,254.723},{267.857,252.814},{263.663,251.113},{259.728,249.498},{256.001,247.849},{252.41,246.065},{248.876,244.081},{245.31,241.874},{241.629,239.458},{237.756,236.882},{233.63,234.21},{229.22,231.51},{224.533,228.845},{219.628,226.269},{214.622,223.832},{209.69,221.586},{205.062,219.59},{201.002,217.913},{197.794,216.628},{195.665,215.794},{194.563,215.368},},{{0, 3610.84, -12.2788, -2.39078, 16, 16, },{14, 3385.7, -14.6971, 1.94348, 16, 16, },{31, 3048.03, 2.5914, -1.90265, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{299.076,244.027},{298.063,243.392},{296.138,242.151},{293.31,240.251},{289.847,237.797},{286.041,234.926},{282.128,231.772},{278.275,228.454},{274.576,225.069},{271.058,221.683},{267.708,218.341},{264.482,215.07},{261.328,211.893},{258.186,208.834},{255.006,205.929},{251.74,203.218},{248.346,200.739},{244.786,198.511},{241.027,196.53},{237.047,194.756},{232.836,193.125},{228.402,191.56},{223.769,189.988},{218.975,188.361},{214.06,186.66},{209.063,184.901},{204.01,183.126},{198.917,181.393},{193.789,179.756},{188.627,178.261},{183.432,176.936},{178.211,175.794},{172.98,174.833},{167.764,174.047},{162.589,173.42},{157.476,172.936},{152.429,172.568},{147.429,172.284},{142.432,172.039},{137.381,171.778},{132.228,171.433},{126.959,170.928},{121.604,170.18},{116.243,169.114},{110.978,167.669},{105.911,165.808},{101.109,163.535},{96.5889,160.89},{92.3114,157.957},{88.1965,154.849},{84.1446,151.699},{80.0604,148.642},{75.8737,145.792},{71.5543,143.225},{67.1224,140.972},{62.6547,139.024},{58.2865,137.353},{54.2058,135.933},{50.6368,134.76},{47.8216,133.859},{45.9566,133.267},{44.9924,132.961},},{{0, 3330.83, 16.9206, -1.85129, 16, 16, },{18, 3116.16, 9.5141, -4.42374, 16, 16, },{38, 2893.1, 6.54877, -2.8504, 16, 16, },{61, 2611.64, 4.95731, -1.79379, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{438.833,402.345},{437.692,401.432},{435.473,399.678},{432.088,397.052},{427.719,393.755},{422.587,390.023},{416.899,386.074},{410.843,382.1},{404.586,378.259},{398.274,374.676},{392.018,371.441},{385.885,368.607},{379.895,366.189},{374.026,364.163},{368.236,362.476},{362.481,361.049},{356.74,359.793},{351.023,358.615},{345.373,357.431},{339.861,356.168},{334.57,354.769},{329.583,353.193},{324.958,351.421},{320.718,349.461},{316.841,347.341},{313.262,345.111},{309.886,342.822},{306.602,340.517},{303.296,338.219},{299.868,335.929},{296.233,333.637},{292.327,331.325},{288.109,328.982},{283.563,326.605},{278.698,324.205},{273.548,321.796},{268.166,319.396},{262.62,317.022},{256.987,314.682},{251.348,312.373},{245.782,310.079},{240.367,307.773},{235.167,305.42},{230.235,302.987},{225.605,300.446},{221.279,297.781},{217.235,294.985},{213.418,292.059},{209.752,289.005},{206.147,285.833},{202.521,282.554},{198.807,279.195},{194.97,275.794},{191.005,272.407},{186.943,269.096},{182.835,265.924},{178.742,262.945},{174.721,260.188},{170.806,257.655},{167.008,255.317},{163.307,253.118},{159.662,250.985},{156.029,248.842},{152.375,246.626},{148.685,244.297},{144.971,241.839},{141.262,239.257},{137.599,236.562},{134.022,233.769},{130.574,230.885},{127.293,227.921},{124.226,224.902},{121.431,221.888},{118.975,218.989},{116.938,216.371},{115.398,214.241},{114.409,212.795},{113.909,212.034},},{{0, 3454.16, 5.38104, 3.26498, 16, 16, },{27, 3117.04, 9.57526, 4.89395, 16, 16, },{60, 2780.58, 2.08737, 13.7989, 16, 16, },{77, 2740.8, 0.488708, 5.73804, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{527.797,26.832},{528.03,27.9669},{528.512,30.1455},{529.315,33.4001},{530.458,37.4753},{531.94,42.08},{533.737,46.9706},{535.799,51.9732},{538.059,56.9952},{540.443,62.0148},{542.879,67.0564},{545.298,72.1614},{547.638,77.3628},{549.848,82.669},{551.882,88.0611},{553.709,93.4991},{555.315,98.9326},{556.709,104.311},{557.92,109.591},{558.998,114.747},{560.002,119.772},{560.989,124.686},{562.004,129.529},{563.072,134.357},{564.196,139.226},{565.359,144.181},{566.529,149.247},{567.674,154.432},{568.764,159.728},{569.78,165.119},{570.712,170.587},{571.557,176.115},{572.312,181.689},{572.967,187.303},{573.508,192.951},{573.916,198.628},{574.166,204.322},{574.233,210.01},{574.093,215.655},{573.724,221.216},{573.115,226.657},{572.283,231.958},{571.272,237.126},{570.165,242.197},{569.066,247.224},{568.082,252.267},{567.302,257.368},{566.778,262.541},{566.524,267.768},{566.518,273.003},{566.717,278.189},{567.07,283.271},{567.531,288.219},{568.055,293.037},{568.602,297.772},{569.13,302.5},{569.603,307.315},{569.986,312.298},{570.251,317.499},{570.376,322.932},{570.346,328.579},{570.15,334.403},{569.78,340.361},{569.236,346.409},{568.522,352.508},{567.652,358.623},{566.642,364.725},{565.507,370.798},{564.249,376.84},{562.861,382.863},{561.321,388.885},{559.608,394.912},{557.7,400.93},{555.596,406.896},{553.314,412.736},{550.899,418.357},{548.424,423.647},{545.987,428.488},{543.707,432.752},{541.715,436.304},{540.148,439.006},{539.111,440.751},{538.576,441.64},},{{0, 2667.15, -3.12903, 12.1145, 16, 16, },{22, 2952.1, 14.9727, -7.30704, 16, 16, },{55, 3166.19, 0.634552, 7.48703, 16, 16, },{82, 3435.44, -3.43134, 10.2758, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{988.62,111.161},{985.973,112.915},{980.854,116.326},{973.158,121.508},{963.526,128.105},{952.819,135.646},{941.91,143.66},{931.58,151.74},{922.403,159.595},{914.679,167.068},{908.458,174.12},{903.588,180.784},{899.811,187.117},{896.826,193.16},{894.344,198.92},{892.109,204.372},{889.9,209.476},{887.543,214.188},{884.91,218.488},{881.929,222.383},{878.582,225.91},{874.898,229.129},{870.934,232.113},{866.763,234.933},{862.451,237.656},{858.053,240.336},{853.605,243.017},{849.127,245.728},{844.625,248.483},{840.102,251.287},{835.559,254.134},{830.999,257.023},{826.411,259.963},{821.766,262.98},{817.009,266.113},{812.079,269.405},{806.938,272.884},{801.597,276.554},{796.132,280.397},{790.679,284.382},{785.404,288.487},{780.475,292.717},{776.033,297.103},{772.178,301.692},{768.968,306.526},{766.417,311.625},{764.491,316.975},{763.117,322.539},{762.191,328.259},{761.593,334.071},{761.199,339.908},{760.898,345.7},{760.587,351.371},{760.184,356.837},{759.621,362.013},{758.852,366.826},{757.857,371.237},{756.643,375.261},{755.247,378.974},{753.727,382.506},{752.154,386.02},{750.601,389.677},{749.134,393.604},{747.798,397.876},{746.615,402.508},{745.587,407.467},{744.699,412.69},{743.932,418.102},{743.267,423.637},{742.694,429.247},{742.204,434.899},{741.79,440.569},{741.436,446.23},{741.115,451.844},{740.787,457.36},{740.397,462.723},{739.88,467.886},{739.165,472.833},{738.174,477.591},{736.834,482.23},{735.086,486.847},{732.894,491.543},{730.259,496.395},{727.221,501.43},{723.855,506.627},{720.265,511.918},{716.563,517.21},{712.86,522.407},{709.25,527.423},{705.807,532.188},{702.591,536.638},{699.651,540.709},{697.048,544.315},{694.855,547.349},{693.165,549.68},{692.06,551.199},{691.492,551.977},},{{0, 2739.29, 12.9872, -0.403351, 16, 16, },{34, 3023.97, 10.3705, -0.856567, 16, 16, },{59, 3128.78, -1.73602, 11.2422, 16, 16, },{79, 3327.63, 0.52243, 8.32059, 16, 16, },{96, 3407.03, -0.800232, 6.84448, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{700.482,393.695},{699.672,394.244},{698.147,395.347},{695.94,397.107},{693.304,399.514},{690.512,402.532},{687.785,406.12},{685.263,410.217},{683,414.748},{680.965,419.617},{679.07,424.704},{677.197,429.877},{675.222,434.991},{673.038,439.913},{670.579,444.541},{667.818,448.825},{664.769,452.771},{661.478,456.437},{658.002,459.9},{654.41,463.223},{650.778,466.422},{647.206,469.454},{643.833,472.221},{640.838,474.596},{638.438,476.438},{636.826,477.641},{635.984,478.258},},{{0, 3304.88, 13.048, -6.54065, 16, 16, },{26, 3459.22, -3.70837, 7.1553, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{565.521,461.989},{565.66,460.443},{565.945,457.477},{566.418,453.061},{567.098,447.583},{568.008,441.521},{569.181,435.33},{570.664,429.394},{572.519,423.994},{574.813,419.292},{577.598,415.337},{580.894,412.082},{584.666,409.402},{588.822,407.117},{593.221,405.029},{597.692,402.944},{602.065,400.708},{606.185,398.223},{609.935,395.449},{613.236,392.39},{616.052,389.076},{618.379,385.531},{620.251,381.76},{621.725,377.745},{622.874,373.456},{623.779,368.868},{624.514,363.977},{625.14,358.808},{625.703,353.407},{626.234,347.831},{626.751,342.133},{627.268,336.347},{627.792,330.487},{628.335,324.556},{628.908,318.56},{629.523,312.528},{630.196,306.516},{630.945,300.607},{631.789,294.893},{632.756,289.447},{633.876,284.305},{635.185,279.455},{636.714,274.845},{638.493,270.412},{640.541,266.105},{642.872,261.906},{645.501,257.841},{648.443,253.968},{651.715,250.354},{655.329,247.057},{659.286,244.105},{663.561,241.482},{668.11,239.133},{672.863,236.977},{677.734,234.927},{682.631,232.915},{687.468,230.909},{692.175,228.906},{696.707,226.928},{701.052,224.993},{705.228,223.095},{709.271,221.19},{713.218,219.197},{717.081,217.008},{720.837,214.516},{724.426,211.638},{727.765,208.332},{730.772,204.601},{733.389,200.487},{735.593,196.057},{737.395,191.387},{738.831,186.542},{739.948,181.568},{740.784,176.479},{741.365,171.245},{741.701,165.796},{741.79,160.031},{741.624,153.847},{741.204,147.167},{740.546,139.971},{739.691,132.31},{738.704,124.296},{737.669,116.08},{736.68,107.822},{735.829,99.6631},{735.198,91.7124},{734.858,84.0406},{734.867,76.69},{735.272,69.6878},{736.106,63.0628},{737.385,56.8576},{739.103,51.1332},{741.233,45.9592},{743.73,41.3962},{746.546,37.4733},{749.643,34.1735},{752.994,31.433},{756.585,29.1549},{760.4,27.2322},{764.399,25.5715},{768.505,24.1096},{772.587,22.8184},{776.461,21.7004},{779.901,20.7775},{782.652,20.0809},{784.494,19.6341},{785.453,19.4079},},{{0, 3822.81, -11.853, -9.74387, 16, 16, },{22, 3793.29, -1.43866, -12.3833, 16, 16, },{41, 4016.86, -3.75388, -9.40033, 16, 16, },{61, 3673.86, -7.51312, -4.0545, 16, 16, },{75, 3805.38, 3.82608, -6.46216, 16, 16, },{96, 3526.91, 0.373413, -0.362549, 16, 16, },{106, 3425.54, 4.30127, -9.13898, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{606.407,43.52},{606.632,45.0453},{607.075,48.0087},{607.76,52.5158},{608.657,58.2953},{609.718,65.0109},{610.891,72.3556},{612.129,80.0715},{613.393,87.9662},{614.661,95.9115},{615.929,103.83},{617.206,111.681},{618.503,119.443},{619.829,127.104},{621.179,134.665},{622.531,142.135},{623.855,149.536},{625.115,156.9},{626.279,164.251},{627.32,171.592},{628.222,178.874},{628.976,185.984},{629.584,192.741},{630.051,198.9},{630.391,204.179},{630.618,208.279},{630.75,210.965},{630.812,212.344},},{{0, 3451.19, -4.50385, -5.79181, 16, 16, },{27, 3590.68, -6.81384, 2.66879, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{653.205,39.2154},{653.323,40.787},{653.553,43.81},{653.907,48.3299},{654.382,53.9752},{654.983,60.2945},{655.732,66.8768},{656.66,73.3984},{657.788,79.66},{659.115,85.5917},{660.606,91.2292},{662.191,96.6732},{663.783,102.044},{665.293,107.445},{666.65,112.94},{667.813,118.555},{668.771,124.276},{669.542,130.072},{670.156,135.899},{670.655,141.714},{671.073,147.473},{671.439,153.126},{671.77,158.605},{672.067,163.808},{672.325,168.581},{672.536,172.721},{672.69,175.983},{672.786,178.149},{672.834,179.272},},{{0, 3090.39, -1.63974, 11.4331, 16, 16, },{28, 3359.78, 2.94623, 3.64584, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{651.41,600.006},{652.592,600.01},{654.875,600.022},{658.314,600.046},{662.671,600.089},{667.664,600.159},{673.047,600.259},{678.623,600.383},{684.252,600.507},{689.844,600.586},{695.336,600.556},{700.685,600.336},{705.852,599.842},{710.81,599.007},{715.547,597.789},{720.07,596.177},{724.398,594.191},{728.548,591.862},{732.519,589.223},{736.277,586.288},{739.757,583.046},{742.881,579.461},{745.582,575.48},{747.831,571.045},{749.647,566.118},{751.098,560.699},{752.287,554.838},{753.336,548.632},{754.365,542.202},{755.48,535.674},{756.76,529.144},{758.249,522.674},{759.957,516.291},{761.861,509.997},{763.917,503.785},{766.075,497.65},{768.297,491.597},{770.564,485.635},{772.88,479.78},{775.268,474.059},{777.757,468.509},{780.367,463.181},{783.106,458.133},{785.962,453.417},{788.908,449.065},{791.901,445.07},{794.888,441.377},{797.813,437.889},{800.628,434.478},{803.296,431.004},{805.804,427.344},{808.159,423.41},{810.386,419.169},{812.527,414.655},{814.638,409.971},{816.788,405.277},{819.062,400.769},{821.55,396.655},{824.335,393.119},{827.476,390.296},{830.993,388.256},{834.868,386.998},{839.045,386.453},{843.452,386.501},{848.008,386.987},{852.639,387.742},{857.279,388.603},{861.876,389.421},{866.396,390.063},{870.827,390.417},{875.18,390.385},{879.476,389.888},{883.736,388.87},{887.963,387.305},{892.129,385.189},{896.182,382.537},{900.05,379.364},{903.657,375.684},{906.939,371.509},{909.854,366.86},{912.386,361.779},{914.547,356.336},{916.371,350.626},{917.914,344.764},{919.24,338.869},{920.419,333.054},{921.517,327.414},{922.589,322.018},{923.676,316.9},{924.803,312.056},{925.988,307.439},{927.245,302.965},{928.594,298.531},{930.059,294.029},{931.661,289.369},{933.421,284.49},{935.347,279.369},{937.442,274.017},{939.7,268.475},{942.117,262.804},{944.695,257.076},{947.448,251.372},{950.396,245.772},{953.56,240.357},{956.945,235.203},{960.53,230.371},{964.259,225.899},{968.045,221.786},{971.779,217.985},{975.347,214.415},{978.645,210.981},{981.591,207.617},{984.128,204.316},{986.228,201.16},{987.877,198.312},{989.071,195.999},{989.813,194.429},{990.182,193.605},},{{0, 3613.05, -0.783447, -0.583923, 16, 16, },{23, 3740.11, 6.31192, -7.8093, 16, 16, },{50, 4065.42, 7.50293, -12.7163, 16, 16, },{70, 3753.26, 17.2634, -4.12866, 16, 16, },{91, 3839.57, -1.30902, -12.2716, 16, 16, },{117, 3304.89, 6.76144, -8.55954, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{852.2,441.661},{853.459,442.535},{855.802,444.272},{859.14,447.003},{863.055,450.654},{867.138,455.085},{871.118,460.113},{874.897,465.492},{878.543,470.921},{882.24,476.063},{886.219,480.578},{890.693,484.166},{895.806,486.597},{901.607,487.742},{908.048,487.57},{915,486.149},{922.282,483.624},{929.687,480.193},{937.012,476.077},{944.08,471.494},{950.746,466.625},{956.909,461.606},{962.511,456.515},{967.539,451.382},{972.024,446.215},{976.039,441.018},{979.68,435.811},{983.053,430.648},{986.249,425.615},{989.319,420.827},{992.258,416.419},{994.998,412.533},{997.416,409.307},{999.349,406.872},{1000.64,405.311},{1001.32,404.522},},{{0, 3914.04, -11.1385, -4.00909, 16, 16, },{35, 3704.97, -3.44238, -12.529, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{1010.01,339.957},{1009.56,340.981},{1008.69,342.978},{1007.35,346.029},{1005.62,349.963},{1003.59,354.55},{1001.35,359.562},{998.963,364.774},{996.467,369.982},{993.872,375.013},{991.161,379.728},{988.308,384.026},{985.289,387.844},{982.094,391.15},{978.731,393.947},{975.221,396.27},{971.586,398.188},{967.848,399.805},{964.021,401.256},{960.124,402.695},{956.187,404.283},{952.252,406.159},{948.368,408.416},{944.577,411.077},{940.892,414.09},{937.293,417.33},{933.729,420.622},{930.145,423.775},{926.517,426.62},{922.889,429.035},{919.389,430.961},{916.225,432.396},{913.657,433.374},{911.919,433.95},{911.008,434.224},},{{0, 3180.51, 7.49692, -2.52557, 16, 16, },{18, 3385.13, 3.73642, 6.44983, 16, 16, },{34, 3580.53, 10.0251, -5.45374, 16, 16, },} });
	//params.curveConstraints.push_back(gain::curve_constraint{ {{877.524,275.324},{877.596,276.466},{877.73,278.675},{877.921,282.018},{878.141,286.281},{878.362,291.214},{878.558,296.597},{878.716,302.249},{878.831,308.028},{878.907,313.818},{878.953,319.501},{878.978,324.934},{878.99,329.932},{878.996,334.268},{878.999,337.678},{878.999,339.937},{879,341.106},},{{0, 3237.01, -1.18698, 5.99277, 16, 16, },{16, 3541.1, 3.60403, 3.61523, 16, 16, },} });


	params.curveConstraints.push_back(gain::curve_constraint{ {{465.314,58.9464},{464.572,59.4655},{463.167,60.4956},{461.114,62.1113},{458.621,64.2662},{455.923,66.8849},{453.213,69.8876},{450.639,73.1933},{448.295,76.7288},{446.24,80.4356},{444.511,84.2755},{443.133,88.2337},{442.12,92.3188},{441.467,96.5556},{441.138,100.973},{441.063,105.587},{441.136,110.389},{441.228,115.335},{441.2,120.349},{440.924,125.332},{440.296,130.183},{439.257,134.82},{437.799,139.199},{435.969,143.327},{433.868,147.256},{431.634,151.07},{429.42,154.86},{427.368,158.699},{425.586,162.637},{424.137,166.702},{423.037,170.91},{422.262,175.282},{421.768,179.838},{421.506,184.593},{421.434,189.546},{421.528,194.664},{421.78,199.892},{422.195,205.155},{422.777,210.384},{423.528,215.519},{424.435,220.522},{425.476,225.374},{426.613,230.065},{427.802,234.599},{428.993,238.982},{430.138,243.241},{431.194,247.42},{432.13,251.587},{432.928,255.828},{433.589,260.229},{434.124,264.854},{434.558,269.73},{434.921,274.839},{435.244,280.128},{435.55,285.52},{435.852,290.935},{436.155,296.294},{436.461,301.534},{436.777,306.61},{437.115,311.502},{437.496,316.222},{437.943,320.814},{438.475,325.344},{439.099,329.885},{439.813,334.492},{440.612,339.193},{441.499,343.979},{442.494,348.808},{443.64,353.612},{445.003,358.307},{446.656,362.815},{448.66,367.068},{451.04,371.026},{453.768,374.688},{456.757,378.087},{459.87,381.288},{462.947,384.382},{465.83,387.466},{468.399,390.639},{470.586,393.989},{472.385,397.582},{473.836,401.459},{475.01,405.628},{475.987,410.066},{476.839,414.721},{477.624,419.514},{478.399,424.352},{479.222,429.136},{480.159,433.777},{481.277,438.219},{482.64,442.443},{484.286,446.47},{486.232,450.348},{488.472,454.129},{490.994,457.85},{493.791,461.52},{496.87,465.131},{500.244,468.654},{503.922,472.061},{507.899,475.323},{512.147,478.415},{516.614,481.323},{521.236,484.048},{525.941,486.615},{530.658,489.072},{535.317,491.493},{539.852,493.964},{544.195,496.564},{548.285,499.346},{552.067,502.332},{555.504,505.507},{558.586,508.823},{561.335,512.214},{563.81,515.597},{566.11,518.891},{568.361,522.021},{570.7,524.942},{573.248,527.647},{576.086,530.171},{579.24,532.589},{582.675,534.993},{586.311,537.48},{590.045,540.131},{593.77,543.001},{597.396,546.117},{600.85,549.475},{604.076,553.046},{607.031,556.781},{609.677,560.621},{611.985,564.509},{613.935,568.397},{615.511,572.258},{616.697,576.085},{617.466,579.878},{617.777,583.628},{617.574,587.295},{616.799,590.81},{615.411,594.077},{613.404,597.001},{610.81,599.515},{607.689,601.596},{604.118,603.277},{600.171,604.628},{595.911,605.743},{591.391,606.705},{586.659,607.573},{581.765,608.357},{576.763,609.025},{571.715,609.505},{566.692,609.706},{561.773,609.541},{557.041,608.939},{552.571,607.865},{548.423,606.318},{544.636,604.326},{541.233,601.94},{538.219,599.217},{535.581,596.223},{533.271,593.033},{531.193,589.743},{529.194,586.47},{527.088,583.349},{524.686,580.508},{521.852,578.042},{518.536,575.987},{514.792,574.3},{510.763,572.869},{506.634,571.532},{502.583,570.118},{498.738,568.487},{495.154,566.56},{491.817,564.333},{488.674,561.851},{485.671,559.186},{482.775,556.402},{479.98,553.538},{477.284,550.62},{474.657,547.665},{472.024,544.702},{469.268,541.77},{466.256,538.918},{462.879,536.197},{459.082,533.657},{454.879,531.34},{450.348,529.28},{445.61,527.497},{440.801,525.999},{436.051,524.789},{431.458,523.88},{427.084,523.301},{422.953,523.1},{419.062,523.343},{415.403,524.095},{411.974,525.409},{408.79,527.315},{405.878,529.811},{403.26,532.87},{400.944,536.439},{398.921,540.445},{397.16,544.803},{395.623,549.418},{394.268,554.189},{393.056,559.019},{391.951,563.812},{390.908,568.485},{389.873,572.975},{388.78,577.239},{387.552,581.264},{386.112,585.06},{384.399,588.654},{382.374,592.072},{380.028,595.333},{377.373,598.441},{374.435,601.391},{371.249,604.172},{367.851,606.781},{364.274,609.224},{360.548,611.516},{356.697,613.672},{352.737,615.707},{348.677,617.62},{344.52,619.402},{340.267,621.038},{335.923,622.515},{331.497,623.832},{326.997,625.007},{322.418,626.077},{317.732,627.084},{312.895,628.069},{307.856,629.063},{302.588,630.081},{297.106,631.132},{291.472,632.23},{285.787,633.405},{280.168,634.707},{274.726,636.196},{269.543,637.936},{264.668,639.967},{260.118,642.301},{255.883,644.909},{251.942,647.734},{248.271,650.699},{244.848,653.73},{241.651,656.766},{238.648,659.777},{235.792,662.763},{233.017,665.758},{230.245,668.817},{227.406,671.998},{224.454,675.346},{221.389,678.87},{218.255,682.535},{215.135,686.255},{212.141,689.897},{209.399,693.293},{207.043,696.252},{205.208,698.577},{204.002,700.113},{203.381,700.905},},{{0, 3441.18, -6.13544, -6.57797, 16, 16, },{13, 3476.76, 0.25882, -5.90268, 16, 16, },{31, 3745.07, 7.0238, -15.0323, 16, 16, },{48, 3857.74, -16.4019, 12.2955, 16, 16, },{61, 4002.03, -1.19232, -14.5237, 16, 16, },{80, 3787.2, -16.2559, 6.54623, 16, 16, },{91, 3904.78, -8.03845, -10.4167, 16, 16, },{116, 3815.71, -15.705, -6.46655, 16, 16, },{133, 3707.58, -17.2917, 4.29929, 16, 16, },{142, 3781.32, -26.5978, 14.8281, 16, 16, },{179, 3633.53, -13.6603, 2.99878, 16, 16, },{190, 3448.63, 2.31073, -10.672, 16, 16, },{207, 3201.65, -5.84348, 2.52005, 16, 16, },{228, 3242.86, -3.67139, 4.96362, 16, 16, },{247, 3052.86, -5.05209, 5.16595, 16, 16, },{258, 3002.55, -6.43216, 2.08432, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{605.847,628.621},{606.038,629.58},{606.408,631.407},{606.957,634.099},{607.614,637.403},{608.259,641.035},{608.742,644.757},{608.9,648.4},{608.585,651.877},{607.695,655.171},{606.193,658.314},{604.101,661.355},{601.49,664.332},{598.451,667.243},{595.074,670.047},{591.426,672.664},{587.559,675.004},{583.508,676.987},{579.301,678.566},{574.957,679.731},{570.481,680.512},{565.846,680.962},{560.99,681.147},{555.821,681.136},{550.245,680.994},{544.196,680.779},{537.675,680.545},{530.762,680.344},{523.622,680.241},{516.471,680.316},{509.542,680.671},{503.042,681.421},{497.12,682.681},{491.855,684.536},{487.263,687.02},{483.298,690.108},{479.875,693.71},{476.87,697.689},{474.138,701.874},{471.517,706.079},{468.844,710.118},{465.979,713.821},{462.822,717.055},{459.329,719.735},{455.505,721.841},{451.39,723.409},{447.031,724.524},{442.462,725.296},{437.694,725.842},{432.729,726.264},{427.57,726.648},{422.247,727.058},{416.813,727.542},{411.347,728.144},{405.933,728.908},{400.65,729.867},{395.551,731.042},{390.661,732.425},{385.972,733.975},{381.45,735.62},{377.05,737.271},{372.726,738.837},{368.441,740.248},{364.17,741.46},{359.894,742.47},{355.591,743.307},{351.229,744.024},{346.769,744.68},{342.171,745.326},{337.4,745.998},{332.44,746.71},{327.301,747.468},{322.015,748.277},{316.641,749.161},{311.254,750.167},{305.941,751.366},{300.787,752.834},{295.856,754.64},{291.183,756.819},{286.769,759.362},{282.581,762.217},{278.58,765.289},{274.742,768.454},{271.09,771.564},{267.711,774.459},{264.75,776.971},{262.4,778.937},{260.833,780.23},{260.018,780.896},},{{0, 3832.06, -13.0633, -8.40482, 16, 16, },{9, 3799.99, -11.6581, -4.80969, 16, 16, },{21, 3597.95, -12.1706, 0.0380249, 16, 16, },{47, 3433.36, -11.6027, -0.559082, 16, 16, },{66, 3233.58, -9.25217, -3.40424, 16, 16, },{88, 2913.51, 1.49188, -2.41473, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{649.117,599.172},{650.114,599.443},{652.016,599.998},{654.828,600.917},{658.289,602.229},{662.096,603.963},{665.977,606.148},{669.709,608.804},{673.134,611.937},{676.155,615.529},{678.733,619.533},{680.869,623.871},{682.592,628.447},{683.95,633.154},{685.006,637.897},{685.834,642.604},{686.524,647.229},{687.183,651.756},{687.929,656.176},{688.882,660.482},{690.15,664.651},{691.806,668.651},{693.874,672.447},{696.322,676.013},{699.064,679.346},{701.977,682.475},{704.927,685.457},{707.799,688.382},{710.52,691.356},{713.08,694.493},{715.527,697.888},{717.951,701.603},{720.461,705.646},{723.152,709.97},{726.081,714.482},{729.251,719.063},{732.608,723.591},{736.046,727.968},{739.429,732.131},{742.61,736.065},{745.454,739.8},{747.855,743.406},{749.751,746.982},{751.127,750.644},{752.017,754.501},{752.502,758.64},{752.698,763.105},{752.748,767.891},{752.798,772.943},{752.984,778.172},{753.407,783.471},{754.123,788.743},{755.136,793.908},{756.399,798.92},{757.83,803.762},{759.329,808.443},{760.801,812.989},{762.176,817.439},{763.412,821.843},{764.499,826.265},{765.442,830.779},{766.252,835.456},{766.934,840.348},{767.487,845.478},{767.898,850.822},{768.158,856.325},{768.251,861.898},{768.165,867.444},{767.879,872.859},{767.359,878.054},{766.557,882.958},{765.407,887.525},{763.837,891.728},{761.781,895.554},{759.201,898.988},{756.101,902.011},{752.542,904.596},{748.638,906.708},{744.546,908.308},{740.447,909.343},{736.516,909.749},{732.897,909.449},{729.679,908.371},{726.888,906.47},{724.498,903.752},{722.441,900.286},{720.638,896.197},{719.011,891.648},{717.495,886.806},{716.039,881.828},{714.601,876.841},{713.137,871.946},{711.602,867.22},{709.948,862.711},{708.123,858.445},{706.076,854.411},{703.767,850.577},{701.174,846.893},{698.299,843.313},{695.174,839.808},{691.848,836.379},{688.369,833.054},{684.768,829.876},{681.046,826.892},{677.173,824.141},{673.103,821.647},{668.798,819.413},{664.248,817.422},{659.481,815.644},{654.567,814.037},{649.599,812.556},{644.671,811.161},{639.848,809.819},{635.151,808.505},{630.548,807.201},{625.972,805.892},{621.342,804.565},{616.593,803.22},{611.694,801.866},{606.65,800.528},{601.492,799.244},{596.261,798.059},{590.997,797.015},{585.734,796.149},{580.508,795.483},{575.358,795.033},{570.323,794.808},{565.431,794.82},{560.691,795.087},{556.078,795.631},{551.539,796.469},{547.007,797.604},{542.416,799.013},{537.722,800.643},{532.92,802.414},{528.051,804.231},{523.212,805.996},{518.552,807.621},{514.264,809.036},{510.564,810.19},{507.68,811.046},{505.786,811.588},{504.813,811.859},},{{0, 3617.57, -1.03067, -1.59039, 16, 16, },{17, 3774.18, -16.772, -3.01718, 16, 16, },{29, 3754.87, 1.4592, -7.79025, 16, 16, },{43, 3723.2, 0.563293, -16.3969, 16, 16, },{59, 3651.08, -6.737, -7.83047, 16, 16, },{72, 3625.3, -3.0116, -6.10852, 16, 16, },{82, 3644.86, -0.707916, -0.938629, 16, 16, },{96, 3569.85, -12.1299, -9.23123, 16, 16, },{115, 3514.79, -1.30344, -10.0683, 16, 16, },{129, 3250.21, 2.91736, -6.54211, 16, 16, },{142, 3129.05, -5.48264, 4.20425, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{644.621,874.744},{645.692,875.337},{647.722,876.489},{650.695,878.242},{654.315,880.503},{658.255,883.158},{662.242,886.108},{666.07,889.263},{669.607,892.549},{672.775,895.91},{675.532,899.317},{677.851,902.776},{679.709,906.321},{681.081,909.999},{681.936,913.834},{682.242,917.804},{681.968,921.82},{681.091,925.742},{679.604,929.405},{677.523,932.659},{674.882,935.395},{671.726,937.572},{668.1,939.211},{664.041,940.388},{659.583,941.205},{654.758,941.774},{649.61,942.192},{644.191,942.53},{638.565,942.828},{632.796,943.101},{626.945,943.344},{621.07,943.548},{615.225,943.702},{609.466,943.801},{603.846,943.841},{598.416,943.813},{593.21,943.7},{588.235,943.473},{583.472,943.091},{578.881,942.507},{574.414,941.673},{570.036,940.557},{565.732,939.154},{561.505,937.493},{557.368,935.646},{553.332,933.717},{549.393,931.84},{545.529,930.152},{541.702,928.781},{537.857,927.829},{533.937,927.357},{529.886,927.383},{525.666,927.876},{521.259,928.76},{516.678,929.915},{511.961,931.194},{507.178,932.428},{502.424,933.447},{497.817,934.095},{493.48,934.245},{489.524,933.8},{486.024,932.703},{483,930.931},{480.41,928.501},{478.165,925.463},{476.147,921.905},{474.231,917.942},{472.307,913.708},{470.282,909.344},{468.086,904.989},{465.662,900.775},{462.973,896.814},{460.004,893.195},{456.77,889.972},{453.313,887.163},{449.694,884.752},{445.97,882.705},{442.175,880.976},{438.298,879.524},{434.289,878.309},{430.074,877.291},{425.584,876.427},{420.779,875.673},{415.664,874.992},{410.283,874.358},{404.711,873.758},{399.033,873.19},{393.333,872.661},{387.687,872.174},{382.157,871.732},{376.782,871.338},{371.58,870.993},{366.537,870.703},{361.606,870.47},{356.715,870.294},{351.781,870.171},{346.727,870.089},{341.502,870.033},{336.093,869.989},{330.517,869.936},{324.819,869.854},{319.054,869.716},{313.274,869.495},{307.524,869.166},{301.836,868.712},{296.229,868.131},{290.716,867.435},{285.308,866.651},{280.034,865.815},{274.945,864.96},{270.137,864.123},{265.752,863.336},{261.973,862.64},{259.017,862.081},{257.065,861.704},{256.058,861.505},},{{0, 3508.51, -6.18292, -8.68561, 16, 16, },{12, 3634.28, -4.27536, -6.76999, 16, 16, },{22, 3620.13, -4.83008, 2.13235, 16, 16, },{38, 3636.15, -3.29459, 1.73495, 16, 16, },{50, 3561.98, 2.81366, -7.10797, 16, 16, },{62, 3301.83, 9.90359, -11.6822, 16, 16, },{79, 3150.6, -0.895508, -10.4285, 16, 16, },{94, 3138.97, -5.11777, -2.05933, 16, 16, },{115, 2875.46, 7.12714, -5.40335, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{456.076,443.152},{455.187,442.863},{453.445,442.309},{450.759,441.484},{447.251,440.455},{443.078,439.298},{438.391,438.077},{433.323,436.844},{427.99,435.633},{422.488,434.46},{416.906,433.321},{411.33,432.193},{405.845,431.033},{400.54,429.779},{395.494,428.362},{390.771,426.722},{386.406,424.826},{382.396,422.685},{378.692,420.367},{375.208,417.987},{371.828,415.69},{368.421,413.612},{364.859,411.851},{361.037,410.445},{356.891,409.366},{352.408,408.533},{347.627,407.834},{342.635,407.149},{337.542,406.373},{332.461,405.431},{327.479,404.293},{322.64,402.969},{317.946,401.51},{313.361,399.991},{308.832,398.497},{304.309,397.108},{299.768,395.878},{295.209,394.837},{290.645,393.983},{286.091,393.295},{281.538,392.736},{276.954,392.267},{272.286,391.847},{267.482,391.443},{262.502,391.028},{257.335,390.587},{251.999,390.11},{246.532,389.592},{240.989,389.032},{235.426,388.435},{229.893,387.808},{224.432,387.168},{219.07,386.537},{213.826,385.943},{208.706,385.411},{203.709,384.958},{198.818,384.588},{193.998,384.289},{189.197,384.036},{184.355,383.796},{179.416,383.532},{174.344,383.213},{169.124,382.812},{163.769,382.309},{158.305,381.691},{152.772,380.948},{147.216,380.082},{141.687,379.103},{136.239,378.029},{130.933,376.879},{125.833,375.663},{120.996,374.376},{116.461,372.995},{112.229,371.486},{108.257,369.819},{104.452,367.981},{100.69,365.988},{96.841,363.888},{92.7935,361.751},{88.4762,359.658},{83.8662,357.685},{78.9913,355.894},{73.9281,354.323},{68.8025,352.991},{63.7899,351.896},{59.1124,351.026},{55.0257,350.363},{51.8038,349.893},{49.6695,349.604},{48.5658,349.462},},{{0, 3748.92, -18.6775, -9.31885, 16, 16, },{23, 3560.69, 7.17798, -6.24509, 16, 16, },{41, 3541.31, 8.33981, -13.8751, 16, 16, },{58, 3414.22, -2.07108, -7.15094, 16, 16, },{74, 3381.16, -7.11584, 2.84238, 16, 16, },{89, 3199.38, 2.22665, 2.92606, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{409.307,326.329},{408.515,325.959},{406.99,325.23},{404.701,324.091},{401.816,322.577},{398.527,320.739},{394.996,318.632},{391.348,316.323},{387.661,313.892},{383.969,311.435},{380.271,309.061},{376.532,306.875},{372.7,304.964},{368.712,303.378},{364.509,302.116},{360.056,301.125},{355.352,300.305},{350.442,299.523},{345.411,298.632},{340.365,297.492},{335.41,295.994},{330.629,294.08},{326.069,291.753},{321.736,289.074},{317.605,286.154},{313.631,283.121},{309.768,280.1},{305.987,277.188},{302.277,274.444},{298.649,271.886},{295.118,269.495},{291.694,267.217},{288.369,264.984},{285.113,262.72},{281.88,260.362},{278.615,257.866},{275.253,255.218},{271.729,252.421},{267.977,249.492},{263.939,246.446},{259.572,243.302},{254.859,240.083},{249.817,236.829},{244.494,233.598},{238.963,230.463},{233.306,227.494},{227.603,224.737},{221.92,222.209},{216.301,219.892},{210.772,217.746},{205.346,215.723},{200.028,213.78},{194.821,211.887},{189.731,210.029},{184.761,208.206},{179.913,206.423},{175.188,204.689},{170.596,203.016},{166.17,201.418},{161.978,199.919},{158.134,198.556},{154.8,197.382},{152.175,196.464},{150.433,195.857},{149.53,195.543},},{{0, 3866.94, 2.62802, -14.549, 16, 16, },{14, 3714.43, 12.8926, -8.41614, 16, 16, },{32, 3527.16, -13.3383, 5.67154, 16, 16, },{64, 2940.41, -3.24139, -2.80087, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{373.66,257.132},{373.334,256.108},{372.705,254.137},{371.757,251.177},{370.543,247.448},{369.11,243.209},{367.481,238.695},{365.649,234.1},{363.587,229.574},{361.264,225.222},{358.65,221.109},{355.738,217.259},{352.549,213.655},{349.145,210.242},{345.626,206.933},{342.121,203.628},{338.772,200.235},{335.705,196.681},{332.997,192.926},{330.668,188.957},{328.67,184.777},{326.905,180.399},{325.248,175.841},{323.571,171.133},{321.766,166.319},{319.753,161.454},{317.488,156.601},{314.967,151.819},{312.227,147.145},{309.35,142.591},{306.458,138.132},{303.703,133.72},{301.245,129.294},{299.232,124.804},{297.78,120.234},{296.954,115.605},{296.766,110.979},{297.17,106.432},{298.074,102.034},{299.353,97.8244},{300.876,93.8005},{302.529,89.9204},{304.226,86.1201},{305.916,82.3374},{307.571,78.538},{309.169,74.7371},{310.679,71.012},{312.054,67.5032},{313.232,64.4013},{314.145,61.9281},{314.742,60.2751},{315.048,59.415},},{{0, 3692.94, -16.2322, -2.65552, 16, 16, },{20, 3547.7, -8.26212, 9.96335, 16, 16, },{42, 3231.05, 6.46347, -8.08884, 16, 16, },{51, 3254.38, 1.17566, -3.49887, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{557.967,468.362},{558.165,466.984},{558.564,464.35},{559.205,460.442},{560.088,455.597},{561.214,450.197},{562.582,444.561},{564.198,438.923},{566.068,433.423},{568.191,428.134},{570.56,423.099},{573.157,418.365},{575.96,414.01},{578.95,410.142},{582.114,406.891},{585.443,404.367},{588.926,402.632},{592.533,401.652},{596.207,401.288},{599.86,401.294},{603.379,401.354},{606.647,401.14},{609.57,400.373},{612.093,398.883},{614.214,396.631},{615.985,393.709},{617.489,390.294},{618.822,386.595},{620.069,382.789},{621.286,378.984},{622.493,375.199},{623.679,371.378},{624.813,367.424},{625.848,363.238},{626.743,358.752},{627.471,353.952},{628.022,348.878},{628.409,343.616},{628.66,338.281},{628.811,332.994},{628.906,327.868},{628.993,322.989},{629.123,318.406},{629.341,314.139},{629.674,310.179},{630.107,306.507},{630.567,303.101},{630.926,299.938},{631.024,296.986},{630.722,294.199},{629.956,291.497},{628.774,288.773},{627.342,285.897},{625.901,282.737},{624.709,279.191},{623.975,275.199},{623.822,270.756},{624.268,265.9},{625.247,260.699},{626.632,255.232},{628.276,249.574},{630.039,243.788},{631.81,237.929},{633.513,232.038},{635.105,226.147},{636.568,220.284},{637.891,214.465},{639.066,208.702},{640.084,203.003},{640.933,197.375},{641.608,191.831},{642.114,186.387},{642.47,181.059},{642.701,175.855},{642.835,170.757},{642.899,165.721},{642.905,160.684},{642.857,155.575},{642.743,150.335},{642.541,144.931},{642.219,139.363},{641.749,133.653},{641.104,127.839},{640.277,121.962},{639.276,116.06},{638.128,110.17},{636.869,104.319},{635.531,98.5355},{634.127,92.8433},{632.639,87.2688},{631.017,81.8413},{629.196,76.5942},{627.119,71.5621},{624.768,66.774},{622.183,62.2441},{619.457,57.9644},{616.719,53.9024},{614.097,50.0059},{611.69,46.2153},{609.556,42.482},{607.712,38.7911},{606.154,35.1825},{604.871,31.7655},{603.857,28.7151},{603.115,26.2569},{602.649,24.5988},{602.415,23.7304},},{{0, 3770.98, 4.99774, -14.6624, 16, 16, },{30, 3743.72, 4.49127, -10.4061, 16, 16, },{43, 3960.03, 1.92001, -13.0573, 16, 16, },{75, 3494.91, -5.22314, 0.334656, 16, 16, },{99, 3440.03, -9.27222, -0.289703, 16, 16, },{106, 3382.57, -2.66345, -1.60196, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{652.216,269.948},{652.855,269.034},{654.097,267.311},{655.994,264.806},{658.451,261.784},{661.363,258.527},{664.644,255.255},{668.229,252.11},{672.071,249.163},{676.13,246.43},{680.368,243.9},{684.751,241.551},{689.242,239.36},{693.807,237.305},{698.413,235.361},{703.019,233.499},{707.573,231.68},{712.007,229.85},{716.234,227.941},{720.153,225.869},{723.664,223.541},{726.685,220.862},{729.167,217.751},{731.103,214.155},{732.531,210.056},{733.522,205.478},{734.167,200.478},{734.56,195.138},{734.782,189.545},{734.9,183.782},{734.957,177.919},{734.982,172.012},{734.993,166.107},{734.997,160.248},{734.999,154.475},{734.999,148.83},{734.999,143.341},{734.999,138.015},{734.999,132.828},{734.999,127.721},{735,122.614},{735.001,117.417},{735.005,112.058},{735.015,106.502},{735.038,100.752},{735.09,94.8547},{735.195,88.8868},{735.392,82.9429},{735.739,77.1241},{736.307,71.5297},{737.18,66.2502},{738.443,61.3619},{740.167,56.9203},{742.397,52.9545},{745.141,49.4629},{748.362,46.4136},{751.989,43.7506},{755.917,41.407},{760.025,39.3198},{764.172,37.445},{768.203,35.7657},{771.941,34.2932},{775.189,33.0613},{777.739,32.1181},{779.424,31.505},{780.294,31.1916},},{{0, 3991.49, -3.3728, -6.37988, 16, 16, },{22, 3754.5, 1.03021, -4.54626, 16, 16, },{39, 3540.18, -3.52374, 2.39453, 16, 16, },{65, 3470.2, -9.20056, -5.42245, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{787.629,163.196},{789.292,162.767},{792.451,161.974},{797.101,160.86},{802.818,159.581},{809.154,158.289},{815.764,157.092},{822.419,156.034},{828.997,155.109},{835.444,154.271},{841.731,153.453},{847.83,152.587},{853.697,151.605},{859.28,150.452},{864.527,149.083},{869.4,147.468},{873.879,145.596},{877.971,143.471},{881.699,141.116},{885.103,138.565},{888.235,135.859},{891.156,133.034},{893.938,130.119},{896.664,127.122},{899.419,124.031},{902.273,120.815},{905.275,117.44},{908.446,113.88},{911.778,110.129},{915.256,106.212},{918.863,102.174},{922.59,98.0792},{926.435,93.9959},{930.389,89.9912},{934.431,86.1237},{938.519,82.4374},{942.597,78.9601},{946.599,75.7053},{950.453,72.6823},{954.073,69.9104},{957.356,67.4326},{960.174,65.3217},{962.376,63.6782},{963.829,62.5949},{964.579,62.0356},},{{0, 3604.15, -7.16772, 1.22107, 16, 16, },{24, 3307.41, -10.1187, 4.57773, 16, 16, },{44, 3055.53, 0.715515, 0.168671, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{730.666,595.861},{731.554,595.461},{733.226,594.648},{735.644,593.325},{738.525,591.47},{741.557,589.076},{744.473,586.14},{747.09,582.681},{749.315,578.742},{751.152,574.395},{752.679,569.739},{754.029,564.897},{755.359,560.003},{756.827,555.187},{758.551,550.554},{760.58,546.162},{762.875,542.004},{765.308,538.01},{767.701,534.062},{769.865,530.031},{771.659,525.813},{773.024,521.364},{773.988,516.706},{774.651,511.921},{775.156,507.125},{775.665,502.438},{776.337,497.959},{777.318,493.748},{778.719,489.821},{780.609,486.154},{782.995,482.694},{785.818,479.36},{788.953,476.055},{792.238,472.673},{795.488,469.109},{798.534,465.275},{801.24,461.114},{803.524,456.603},{805.361,451.756},{806.784,446.619},{807.872,441.258},{808.735,435.755},{809.494,430.201},{810.264,424.689},{811.14,419.319},{812.193,414.2},{813.473,409.447},{815.01,405.185},{816.828,401.539},{818.943,398.618},{821.37,396.493},{824.122,395.182},{827.207,394.638},{830.63,394.753},{834.389,395.37},{838.478,396.312},{842.876,397.4},{847.547,398.473},{852.429,399.402},{857.427,400.087},{862.426,400.449},{867.296,400.421},{871.92,399.936},{876.214,398.929},{880.146,397.348},{883.743,395.166},{887.079,392.398},{890.257,389.101},{893.387,385.36},{896.552,381.272},{899.794,376.926},{903.095,372.394},{906.381,367.724},{909.544,362.942},{912.471,358.057},{915.08,353.066},{917.347,347.966},{919.311,342.765},{921.066,337.492},{922.73,332.2},{924.414,326.958},{926.193,321.842},{928.095,316.918},{930.106,312.234},{932.189,307.814},{934.311,303.651},{936.458,299.708},{938.645,295.922},{940.904,292.213},{943.269,288.493},{945.755,284.688},{948.349,280.75},{951.01,276.667},{953.678,272.454},{956.3,268.149},{958.844,263.798},{961.313,259.447},{963.747,255.14},{966.207,250.91},{968.754,246.78},{971.426,242.76},{974.225,238.847},{977.115,235.029},{980.036,231.298},{982.913,227.656},{985.676,224.136},{988.256,220.807},{990.583,217.776},{992.574,215.177},{994.129,213.156},{995.157,211.831},{995.688,211.15},},{{0, 3643.47, -5.77039, 7.14307, 16, 16, },{27, 3853.3, -12.2734, -3.04916, 16, 16, },{51, 4157.07, -9.59888, -7.26825, 16, 16, },{64, 3877.38, 13.7606, -15.5607, 16, 16, },{88, 3794.37, -6.99985, -5.67398, 16, 16, },{111, 3348.95, -7.34308, -0.495422, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{861.357,501.193},{862.918,500.913},{865.884,500.375},{870.253,499.564},{875.626,498.529},{881.566,497.313},{887.721,495.938},{893.831,494.402},{899.731,492.678},{905.321,490.733},{910.544,488.527},{915.367,486.027},{919.778,483.214},{923.79,480.082},{927.436,476.644},{930.775,472.931},{933.88,468.99},{936.834,464.885},{939.719,460.69},{942.614,456.478},{945.586,452.302},{948.693,448.18},{951.983,444.089},{955.492,439.978},{959.24,435.794},{963.224,431.518},{967.419,427.18},{971.779,422.858},{976.247,418.656},{980.765,414.664},{985.285,410.937},{989.771,407.486},{994.192,404.286},{998.504,401.308},{1002.63,398.543},{1006.45,396.027},{1009.78,393.846},{1012.43,392.123},{1014.18,390.976},{1015.1,390.379},},{{0, 3877.57, -17.1415, 11.3218, 16, 16, },{22, 3773.43, -3.10611, -12.1317, 16, 16, },{39, 3658.78, 9.85776, -13.5863, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{17.7949,488.986},{18.6901,489.701},{20.4564,491.047},{23.2037,493},{26.825,495.347},{31.1523,497.87},{35.9874,500.415},{41.0971,502.914},{46.2258,505.394},{51.1171,507.957},{55.5438,510.743},{59.3396,513.888},{62.4214,517.487},{64.7954,521.573},{66.5434,526.114},{67.7959,531.031},{68.699,536.219},{69.3856,541.577},{69.9561,547.023},{70.4708,552.506},{70.9523,557.999},{71.394,563.489},{71.7687,568.964},{72.0362,574.395},{72.1447,579.729},{72.0297,584.89},{71.613,589.791},{70.8069,594.358},{69.5269,598.549},{67.7132,602.37},{65.3538,605.88},{62.5009,609.179},{59.2721,612.391},{55.8343,615.644},{52.3745,619.052},{49.0667,622.698},{46.0457,626.619},{43.3937,630.796},{41.1423,635.145},{39.2858,639.511},{37.7992,643.678},{36.6549,647.384},{35.835,650.345},{35.3262,652.324},{35.0734,653.354},},{{0, 3459.65, -1.65442, -11.6162, 16, 16, },{29, 3220.87, 3.34027, -5.39191, 16, 16, },{44, 2980.22, -1.92676, 0.824402, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{95.3916,907.624},{95.3903,908.714},{95.4025,910.819},{95.4556,913.99},{95.5853,918.006},{95.8264,922.602},{96.205,927.548},{96.7311,932.664},{97.3939,937.826},{98.1608,942.97},{98.9799,948.064},{99.7874,953.099},{100.516,958.07},{101.105,962.975},{101.505,967.817},{101.682,972.601},{101.612,977.33},{101.277,981.99},{100.659,986.527},{99.754,990.846},{98.5813,994.811},{97.2123,998.271},{95.7831,1001.09},{94.4928,1003.18},{93.5523,1004.48},{93.035,1005.13},},{{0, 3244.96, -1.00195, -6.77045, 16, 16, },{15, 3298.3, -6.03659, 6.5723, 16, 16, },{25, 3359.88, -6.69666, 4.37375, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{787.327,750.654},{787.895,750.023},{788.979,748.903},{790.585,747.451},{792.577,746.032},{794.817,745.013},{797.212,744.66},{799.725,745.067},{802.37,746.149},{805.178,747.669},{808.168,749.302},{811.318,750.712},{814.561,751.609},{817.801,751.782},{820.953,751.111},{823.961,749.566},{826.821,747.194},{829.564,744.105},{832.241,740.461},{834.901,736.442},{837.579,732.232},{840.295,727.987},{843.063,723.82},{845.899,719.796},{848.825,715.942},{851.871,712.252},{855.062,708.705},{858.416,705.272},{861.932,701.922},{865.588,698.622},{869.344,695.341},{873.151,692.054},{876.956,688.745},{880.723,685.419},{884.436,682.094},{888.102,678.803},{891.747,675.579},{895.395,672.449},{899.046,669.431},{902.654,666.538},{906.121,663.799},{909.303,661.272},{912.036,659.054},{914.153,657.285},{915.533,656.096},{916.237,655.475},},{{0, 3683.79, 4.76544, -15.2354, 16, 16, },{15, 3647.26, 8.0488, -10.9803, 16, 16, },{45, 3264.52, -8.59348, 1.203, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{781.709,944.268},{782.711,944.178},{784.663,943.969},{787.638,943.578},{791.467,942.96},{795.934,942.094},{800.839,940.985},{806.006,939.66},{811.293,938.155},{816.587,936.488},{821.797,934.654},{826.849,932.623},{831.675,930.344},{836.221,927.761},{840.438,924.828},{844.297,921.523},{847.789,917.855},{850.93,913.863},{853.761,909.615},{856.345,905.2},{858.755,900.719},{861.06,896.276},{863.322,891.968},{865.583,887.874},{867.871,884.044},{870.198,880.486},{872.563,877.158},{874.954,873.974},{877.352,870.816},{879.727,867.556},{882.049,864.086},{884.289,860.335},{886.424,856.282},{888.44,851.954},{890.331,847.411},{892.1,842.736},{893.76,838.015},{895.325,833.324},{896.816,828.721},{898.257,824.24},{899.669,819.884},{901.07,815.627},{902.475,811.413},{903.89,807.176},{905.314,802.854},{906.736,798.408},{908.141,793.828},{909.507,789.135},{910.808,784.372},{912.022,779.599},{913.132,774.904},{914.123,770.405},{914.986,766.265},{915.705,762.678},{916.257,759.865},{916.62,758.007},{916.806,757.048},},{{0, 3667.51, 2.13934, -2.29346, 16, 16, },{27, 3720.86, -10.9148, -7.62509, 16, 16, },{43, 3593.1, -5.83865, -14.8058, 16, 16, },{56, 3318.17, -0.544067, -14.4386, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{1015.15,754.408},{1014.78,755.48},{1014.1,757.564},{1013.12,760.737},{1012,764.815},{1010.85,769.572},{1009.79,774.802},{1008.88,780.33},{1008.14,786.019},{1007.55,791.768},{1007.1,797.508},{1006.78,803.188},{1006.59,808.771},{1006.55,814.222},{1006.71,819.502},{1007.08,824.557},{1007.68,829.319},{1008.47,833.698},{1009.38,837.584},{1010.3,840.851},{1011.09,843.355},{1011.65,844.984},{1011.96,845.817},},{{0, 3822.49, -12.0149, 9.10526, 16, 16, },{22, 3790.83, -12.6712, 7.77048, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{872.228,949.641},{873.27,950.466},{875.312,952.025},{878.462,954.291},{882.579,957.016},{887.473,959.919},{892.957,962.759},{898.842,965.352},{904.938,967.574},{911.045,969.35},{916.949,970.628},{922.423,971.37},{927.249,971.539},{931.245,971.101},{934.306,970.035},{936.432,968.339},{937.745,966.03},{938.478,963.156},{938.933,959.79},{939.43,956.028},{940.248,951.988},{941.579,947.796},{943.507,943.575},{946.017,939.437},{949.026,935.482},{952.42,931.801},{956.09,928.485},{959.945,925.632},{963.919,923.34},{967.96,921.699},{972.013,920.764},{976.008,920.529},{979.852,920.911},{983.411,921.741},{986.521,922.793},{988.984,923.811},{990.624,924.568},{991.477,924.987},},{{0, 3577.99, -17.3499, 13.9474, 16, 16, },{15, 3430.62, -2.18781, 1.43362, 16, 16, },{37, 3751.21, -9.07446, 6.71448, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{21.0993,198.066},{21.4731,199.372},{22.2218,201.876},{23.4122,205.604},{25.0262,210.248},{27.022,215.456},{29.3441,220.938},{31.9217,226.493},{34.674,232.019},{37.5181,237.485},{40.3801,242.89},{43.2051,248.229},{45.9659,253.461},{48.668,258.508},{51.3516,263.262},{54.0913,267.612},{56.9926,271.465},{60.1842,274.776},{63.8006,277.557},{67.9558,279.884},{72.712,281.875},{78.0541,283.66},{83.8809,285.352},{90.0171,287.017},{96.2406,288.67},{102.314,290.278},{108.003,291.785},{113.092,293.122},{117.374,294.231},{120.652,295.065},{122.779,295.596},{123.865,295.863},},{{0, 3086.47, 0.467712, -0.413635, 16, 16, },{18, 3293.42, -5.34354, -0.230743, 16, 16, },{31, 3000.65, 3.74976, -2.18671, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{633.478,528.966},{634.112,528.27},{635.334,526.933},{637.18,524.936},{639.534,522.434},{642.268,519.603},{645.278,516.59},{648.484,513.5},{651.821,510.392},{655.228,507.284},{658.639,504.17},{661.978,501.03},{665.164,497.848},{668.123,494.615},{670.803,491.33},{673.183,487.989},{675.279,484.583},{677.138,481.088},{678.824,477.477},{680.405,473.723},{681.938,469.818},{683.462,465.767},{684.999,461.595},{686.553,457.34},{688.117,453.056},{689.673,448.815},{691.19,444.723},{692.619,440.927},{693.889,437.612},{694.911,434.99},{695.602,433.248},{695.964,432.344},},{{0, 3659.34, -5.37201, -0.826691, 16, 16, },{16, 3757.22, -12.8062, -5.71515, 16, 16, },{31, 3553.99, 1.94446, -15.0706, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{39.3165,126.317},{40.8864,127.176},{43.8977,128.795},{48.3813,131.148},{53.9477,133.996},{60.1249,137.096},{66.4728,140.291},{72.6197,143.517},{78.2918,146.805},{83.3185,150.237},{87.6263,153.903},{91.2257,157.862},{94.1961,162.114},{96.6669,166.601},{98.7918,171.223},{100.721,175.868},{102.573,180.434},{104.422,184.853},{106.296,189.089},{108.192,193.138},{110.1,197.018},{112.021,200.763},{113.987,204.416},{116.055,208.022},{118.301,211.631},{120.807,215.28},{123.636,218.998},{126.824,222.79},{130.361,226.643},{134.197,230.521},{138.25,234.381},{142.43,238.182},{146.658,241.892},{150.885,245.495},{155.1,248.99},{159.316,252.383},{163.557,255.683},{167.848,258.894},{172.198,262.016},{176.607,265.048},{181.063,267.985},{185.548,270.82},{190.037,273.55},{194.492,276.167},{198.868,278.67},{203.111,281.063},{207.179,283.359},{211.053,285.587},{214.747,287.795},{218.318,290.044},{221.846,292.403},{225.424,294.94},{229.131,297.708},{233.019,300.739},{237.109,304.03},{241.397,307.546},{245.866,311.221},{250.497,314.969},{255.277,318.695},{260.204,322.31},{265.273,325.741},{270.483,328.939},{275.817,331.879},{281.25,334.56},{286.741,336.995},{292.244,339.211},{297.714,341.236},{303.109,343.099},{308.399,344.826},{313.561,346.441},{318.58,347.964},{323.444,349.422},{328.148,350.847},{332.699,352.289},{337.134,353.817},{341.523,355.504},{345.969,357.421},{350.586,359.608},{355.474,362.062},{360.691,364.732},{366.234,367.524},{372.045,370.329},{378.03,373.04},{384.081,375.578},{390.094,377.91},{395.982,380.047},{401.673,382.045},{407.104,383.986},{412.223,385.958},{416.99,388.033},{421.388,390.255},{425.416,392.628},{429.088,395.121},{432.411,397.677},{435.377,400.209},{437.952,402.605},{440.078,404.732},{441.684,406.435},{442.715,407.577},{443.239,408.173},},{{0, 2599.14, -3.53989, 4.20651, 16, 16, },{21, 2726.56, 3.36014, 2.15625, 16, 16, },{49, 2947.25, 1.3718, 6.5278, 16, 16, },{75, 3254.66, 2.63022, 9.2117, 16, 16, },{99, 3454.13, 3.50211, 4.45718, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{397.374,28.2887},{397.311,29.4174},{397.157,31.5733},{396.85,34.7751},{396.328,38.7631},{395.537,43.254},{394.44,48.017},{393.03,52.8804},{391.329,57.7311},{389.39,62.5042},{387.288,67.1732},{385.114,71.7425},{382.962,76.2412},{380.926,80.7141},{379.082,85.2096},{377.488,89.7665},{376.174,94.4035},{375.145,99.1176},{374.379,103.891},{373.841,108.704},{373.486,113.551},{373.266,118.445},{373.143,123.416},{373.086,128.496},{373.079,133.71},{373.115,139.062},{373.199,144.533},{373.344,150.084},{373.566,155.67},{373.878,161.243},{374.294,166.764},{374.821,172.204},{375.466,177.543},{376.235,182.767},{377.134,187.86},{378.173,192.81},{379.355,197.603},{380.677,202.229},{382.119,206.687},{383.643,210.986},{385.194,215.148},{386.714,219.21},{388.147,223.219},{389.455,227.234},{390.629,231.324},{391.682,235.557},{392.646,239.986},{393.561,244.627},{394.457,249.443},{395.35,254.334},{396.23,259.13},{397.065,263.609},{397.807,267.517},{398.4,270.589},{398.796,272.616},{399.002,273.662},},{{0, 2771.54, 0.586975, 6.21103, 16, 16, },{21, 3099.82, -11.1296, 17.6303, 16, 16, },{44, 3353.85, 11.6515, -0.453674, 16, 16, },{55, 3476.37, 14.9488, -2.88388, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{149.274,169.368},{150.723,169.489},{153.469,169.735},{157.494,170.139},{162.425,170.715},{167.872,171.482},{173.541,172.457},{179.242,173.649},{184.878,175.053},{190.411,176.644},{195.828,178.384},{201.124,180.225},{206.287,182.117},{211.298,184.01},{216.133,185.87},{220.761,187.681},{225.155,189.46},{229.293,191.257},{233.175,193.148},{236.819,195.221},{240.274,197.549},{243.607,200.171},{246.899,203.08},{250.232,206.223},{253.681,209.515},{257.307,212.861},{261.149,216.17},{265.224,219.375},{269.515,222.435},{273.977,225.334},{278.54,228.074},{283.126,230.668},{287.663,233.135},{292.096,235.499},{296.393,237.779},{300.529,239.989},{304.475,242.126},{308.174,244.164},{311.535,246.044},{314.426,247.683},{316.689,248.976},{318.183,249.835},{318.955,250.28},},{{0, 2925.35, -0.973511, 11.8541, 16, 16, },{19, 3100.5, -4.61667, 9.81329, 16, 16, },{42, 3408.72, 1.46671, 9.21838, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{528.936,27.0088},{529.248,28.2402},{529.869,30.5939},{530.845,34.0849},{532.159,38.4082},{533.785,43.2152},{535.706,48.2052},{537.907,53.1514},{540.37,57.9148},{543.068,62.4394},{545.954,66.7349},{548.969,70.8556},{552.036,74.8778},{555.076,78.8812},{558.015,82.9347},{560.789,87.089},{563.35,91.3764},{565.666,95.8135},{567.723,100.406},{569.518,105.149},{571.06,110.025},{572.367,115.003},{573.458,120.036},{574.356,125.079},{575.082,130.098},{575.657,135.086},{576.096,140.069},{576.415,145.097},{576.63,150.227},{576.752,155.504},{576.792,160.945},{576.752,166.542},{576.629,172.261},{576.414,178.06},{576.093,183.892},{575.65,189.714},{575.067,195.492},{574.328,201.198},{573.413,206.811},{572.309,212.312},{571.014,217.681},{569.55,222.901},{567.964,227.958},{566.334,232.853},{564.759,237.61},{563.34,242.286},{562.166,246.962},{561.292,251.734},{560.736,256.688},{560.484,261.882},{560.495,267.328},{560.719,272.993},{561.107,278.813},{561.62,284.713},{562.224,290.637},{562.89,296.549},{563.586,302.444},{564.276,308.331},{564.923,314.224},{565.493,320.135},{565.96,326.061},{566.311,331.993},{566.542,337.906},{566.654,343.765},{566.651,349.522},{566.528,355.118},{566.276,360.494},{565.881,365.599},{565.327,370.413},{564.601,374.953},{563.695,379.281},{562.609,383.487},{561.348,387.671},{559.927,391.917},{558.368,396.275},{556.698,400.746},{554.946,405.286},{553.142,409.808},{551.315,414.189},{549.506,418.286},{547.774,421.94},{546.209,425},{544.931,427.326},{544.059,428.823},{543.598,429.583},},{{0, 2680.79, -5.24249, 11.9232, 16, 16, },{26, 2920.31, -0.0730286, 7.4082, 16, 16, },{47, 3080.96, 0.318024, 8.59372, 16, 16, },{70, 3354.21, -5.90683, 11.5887, 16, 16, },{84, 3396.98, -2.66611, 11.4199, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{1003.53,97.4698},{1002.59,98.3289},{1000.67,100.011},{997.53,102.611},{993.135,106.04},{987.496,110.199},{980.686,115.012},{972.861,120.414},{964.268,126.33},{955.214,132.672},{946.035,139.33},{937.042,146.188},{928.484,153.128},{920.522,160.044},{913.217,166.847},{906.549,173.471},{900.437,179.874},{894.77,186.037},{889.438,191.958},{884.346,197.64},{879.429,203.086},{874.65,208.293},{869.991,213.254},{865.448,217.961},{861.027,222.408},{856.733,226.596},{852.565,230.53},{848.503,234.229},{844.501,237.724},{840.479,241.067},{836.336,244.326},{831.974,247.581},{827.326,250.905},{822.378,254.359},{817.173,257.979},{811.8,261.782},{806.368,265.768},{800.989,269.931},{795.766,274.26},{790.782,278.748},{786.104,283.387},{781.778,288.17},{777.825,293.085},{774.244,298.12},{771.018,303.253},{768.119,308.462},{765.52,313.717},{763.196,318.994},{761.132,324.266},{759.317,329.512},{757.74,334.713},{756.39,339.853},{755.242,344.925},{754.253,349.933},{753.36,354.897},{752.479,359.849},{751.516,364.816},{750.377,369.801},{748.979,374.77},{747.255,379.644},{745.153,384.315},{742.639,388.671},{739.688,392.617},{736.292,396.107},{732.461,399.146},{728.226,401.79},{723.635,404.126},{718.754,406.255},{713.66,408.272},{708.433,410.252},{703.159,412.254},{697.916,414.317},{692.776,416.472},{687.801,418.744},{683.032,421.152},{678.495,423.712},{674.192,426.431},{670.105,429.313},{666.199,432.365},{662.426,435.601},{658.736,439.037},{655.093,442.68},{651.489,446.508},{647.958,450.447},{644.58,454.36},{641.473,458.053},{638.786,461.299},{636.683,463.859},{635.296,465.551},{634.58,466.424},},{{0, 2716.07, 14.6925, -2.62149, 16, 16, },{30, 2996.8, 6.32718, -0.306061, 16, 16, },{54, 3104.05, 8.30643, -2.87143, 16, 16, },{80, 3355.23, 1.7204, 6.11505, 16, 16, },{89, 3415.77, 2.43805, 1.91507, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{744.751,420.682},{744.672,422.019},{744.509,424.597},{744.238,428.474},{743.855,433.367},{743.363,438.939},{742.765,444.89},{742.061,450.976},{741.236,457.023},{740.254,462.914},{739.068,468.576},{737.63,473.958},{735.908,479.017},{733.899,483.717},{731.631,488.031},{729.147,491.95},{726.493,495.494},{723.699,498.715},{720.771,501.693},{717.702,504.527},{714.481,507.325},{711.117,510.186},{707.65,513.189},{704.154,516.391},{700.723,519.83},{697.461,523.524},{694.455,527.479},{691.766,531.681},{689.421,536.099},{687.419,540.668},{685.735,545.29},{684.336,549.823},{683.193,554.078},{682.288,557.823},{681.621,560.801},{681.197,562.788},{680.982,563.821},},{{0, 3235.26, -5.44199, 13.2837, 16, 16, },{19, 3354.93, 3.03104, 9.79807, 16, 16, },{36, 3394.94, 5.358, 3.7775, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{578.373,575.941},{577.403,575.396},{575.548,574.332},{572.791,572.702},{569.359,570.594},{565.505,568.119},{561.437,565.378},{557.31,562.45},{553.223,559.387},{549.232,556.215},{545.361,552.945},{541.611,549.586},{537.964,546.146},{534.385,542.642},{530.826,539.096},{527.235,535.535},{523.556,531.996},{519.743,528.524},{515.762,525.177},{511.603,522.013},{507.276,519.091},{502.817,516.459},{498.275,514.149},{493.7,512.168},{489.124,510.501},{484.553,509.111},{479.961,507.947},{475.304,506.952},{470.533,506.077},{465.612,505.283},{460.532,504.547},{455.306,503.857},{449.967,503.206},{444.559,502.585},{439.125,501.977},{433.7,501.363},{428.308,500.727},{422.954,500.062},{417.628,499.38},{412.301,498.702},{406.937,498.064},{401.505,497.499},{395.978,497.032},{390.351,496.677},{384.635,496.439},{378.858,496.319},{373.068,496.322},{367.325,496.473},{361.703,496.813},{356.277,497.404},{351.117,498.311},{346.266,499.588},{341.726,501.254},{337.449,503.279},{333.344,505.586},{329.288,508.062},{325.156,510.583},{320.848,513.04},{316.301,515.354},{311.506,517.483},{306.497,519.422},{301.346,521.194},{296.146,522.847},{290.991,524.445},{285.966,526.058},{281.132,527.755},{276.524,529.596},{272.15,531.616},{267.998,533.826},{264.037,536.213},{260.228,538.749},{256.53,541.4},{252.906,544.134},{249.331,546.923},{245.793,549.749},{242.302,552.597},{238.88,555.455},{235.557,558.319},{232.357,561.196},{229.289,564.107},{226.331,567.087},{223.434,570.173},{220.529,573.394},{217.535,576.757},{214.381,580.236},{211.012,583.781},{207.399,587.324},{203.544,590.799},{199.488,594.159},{195.314,597.388},{191.151,600.509},{187.171,603.579},{183.567,606.68},{180.522,609.9},{178.169,613.317},{176.556,616.983},{175.621,620.916},{175.206,625.103},{175.089,629.505},{175.036,634.069},{174.86,638.73},{174.453,643.419},{173.795,648.073},{172.937,652.649},{171.965,657.133},{170.966,661.548},{169.998,665.942},{169.085,670.376},{168.214,674.904},{167.356,679.558},{166.473,684.344},{165.534,689.246},{164.512,694.235},{163.384,699.273},{162.125,704.311},{160.697,709.292},{159.047,714.139},{157.111,718.765},{154.817,723.071},{152.101,726.962},{148.915,730.363},{145.245,733.239},{141.112,735.603},{136.577,737.524},{131.735,739.103},{126.701,740.46},{121.591,741.699},{116.499,742.894},{111.468,744.082},{106.474,745.27},{101.415,746.453},{96.1239,747.628},{90.4109,748.808},{84.1127,750.013},{77.1544,751.265},{69.5926,752.572},{61.6285,753.919},{53.587,755.265},{45.8657,756.55},{38.876,757.71},{32.9881,758.682},{28.5115,759.416},{25.6348,759.886},{24.1791,760.122},},{{0, 3491.23, -7.04556, 17.5541, 16, 16, },{25, 3237.48, 2.57938, 15.6992, 16, 16, },{53, 2886.13, -0.171265, 7.90674, 16, 16, },{81, 2825.64, 1.89996, -0.158478, 16, 16, },{106, 2721.19, 10.372, 3.62793, 16, 16, },{131, 2610.01, 10.6039, -10.3177, 16, 16, },{143, 2520.06, -4.80499, 6.00293, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{658.215,654.777},{657.532,655.542},{656.175,656.969},{654.041,659.01},{651.187,661.425},{647.712,663.986},{643.743,666.547},{639.447,669.065},{635.031,671.582},{630.731,674.202},{626.794,677.04},{623.444,680.189},{620.843,683.695},{619.073,687.547},{618.114,691.688},{617.861,696.042},{618.149,700.543},{618.784,705.159},{619.581,709.906},{620.385,714.842},{621.076,720.04},{621.569,725.546},{621.796,731.342},{621.687,737.312},{621.165,743.25},{620.137,748.889},{618.514,753.955},{616.227,758.221},{613.253,761.55},{609.623,763.914},{605.423,765.385},{600.772,766.112},{595.801,766.278},{590.624,766.062},{585.33,765.618},{579.972,765.061},{574.573,764.472},{569.13,763.908},{563.627,763.41},{558.047,763.009},{552.382,762.733},{546.636,762.609},{540.827,762.663},{534.988,762.932},{529.167,763.455},{523.423,764.27},{517.827,765.404},{512.456,766.861},{507.382,768.621},{502.656,770.643},{498.29,772.871},{494.252,775.247},{490.462,777.718},{486.81,780.237},{483.176,782.767},{479.452,785.281},{475.555,787.757},{471.436,790.175},{467.073,792.515},{462.466,794.75},{457.627,796.851},{452.572,798.786},{447.319,800.529},{441.887,802.068},{436.301,803.406},{430.587,804.568},{424.775,805.589},{418.896,806.512},{412.982,807.384},{407.067,808.245},{401.185,809.123},{395.376,810.026},{389.682,810.945},{384.139,811.848},{378.762,812.691},{373.538,813.421},{368.408,813.994},{363.278,814.381},{358.028,814.575},{352.536,814.594},{346.703,814.467},{340.473,814.237},{333.835,813.941},{326.831,813.616},{319.544,813.292},{312.091,812.998},{304.601,812.761},{297.199,812.606},{289.985,812.556},{283.021,812.627},{276.328,812.824},{269.886,813.139},{263.637,813.547},{257.489,814.009},{251.31,814.477},{244.937,814.908},{238.195,815.267},{230.935,815.539},{223.082,815.719},{214.669,815.813},{205.841,815.822},{196.828,815.735},{187.889,815.523},{179.263,815.139},{171.133,814.522},{163.61,813.612},{156.739,812.362},{150.511,810.753},{144.875,808.792},{139.757,806.516},{135.061,803.974},{130.681,801.22},{126.508,798.304},{122.447,795.281},{118.438,792.222},{114.476,789.22},{110.629,786.391},{107.032,783.864},{103.875,781.758},{101.375,780.173},{99.7133,779.165},{98.8521,778.658},},{{0, 3393.48, 10.5974, 2.56586, 16, 16, },{20, 3165.06, -1.77914, 5.39511, 16, 16, },{52, 2869.46, 0.89093, 4.7901, 16, 16, },{77, 2695.05, 5.10562, 3.66113, 16, 16, },{97, 2650.59, 6.59949, 3.99014, 16, 16, },{113, 2512, 3.30286, 6.76669, 16, 16, },{121, 2535.68, 6.35846, -3.56528, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{512.015,648.966},{510.823,648.83},{508.524,648.568},{505.064,648.171},{500.68,647.67},{495.646,647.105},{490.195,646.522},{484.509,645.972},{478.718,645.505},{472.911,645.173},{467.152,645.028},{461.496,645.124},{456.003,645.522},{450.736,646.285},{445.761,647.478},{441.138,649.152},{436.912,651.336},{433.104,654.027},{429.702,657.178},{426.668,660.707},{423.932,664.503},{421.408,668.444},{418.998,672.411},{416.6,676.308},{414.115,680.059},{411.448,683.613},{408.517,686.933},{405.253,689.989},{401.611,692.756},{397.573,695.22},{393.15,697.382},{388.383,699.262},{383.334,700.902},{378.084,702.357},{372.725,703.683},{367.36,704.937},{362.085,706.162},{356.985,707.391},{352.112,708.64},{347.472,709.912},{343.021,711.199},{338.676,712.486},{334.337,713.756},{329.917,714.998},{325.36,716.211},{320.655,717.398},{315.826,718.571},{310.908,719.74},{305.936,720.914},{300.924,722.093},{295.875,723.275},{290.787,724.462},{285.668,725.668},{280.549,726.927},{275.488,728.3},{270.556,729.861},{265.829,731.682},{261.366,733.814},{257.195,736.271},{253.316,739.027},{249.706,742.033},{246.336,745.23},{243.189,748.572},{240.268,752.029},{237.597,755.577},{235.211,759.178},{233.144,762.755},{231.424,766.172},{230.067,769.235},{229.081,771.708},{228.467,773.377},{228.161,774.251},},{{0, 3257.41, 5.77576, 3.48349, 16, 16, },{24, 3012.91, 5.52246, 3.41467, 16, 16, },{41, 2923.13, 6.50552, 3.85507, 16, 16, },{71, 2806.58, -9.74258, 4.89981, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{615.054,902.908},{614.151,901.929},{612.441,900.029},{609.944,897.145},{606.913,893.463},{603.619,889.221},{600.272,884.652},{596.993,879.973},{593.807,875.374},{590.661,871.012},{587.457,867.014},{584.082,863.473},{580.445,860.452},{576.499,857.977},{572.246,856.042},{567.732,854.609},{563.031,853.617},{558.22,852.989},{553.354,852.649},{548.453,852.524},{543.506,852.556},{538.476,852.694},{533.325,852.897},{528.031,853.128},{522.604,853.355},{517.088,853.555},{511.561,853.714},{506.12,853.828},{500.867,853.899},{495.896,853.932},{491.27,853.926},{487.023,853.868},{483.155,853.732},{479.64,853.469},{476.439,853.011},{473.508,852.279},{470.8,851.198},{468.271,849.72},{465.882,847.845},{463.609,845.638},{461.457,843.228},{459.47,840.803},{457.73,838.576},{456.349,836.765},{455.426,835.544},{454.947,834.907},},{{0, 3236.63, -3.11594, 11.0368, 16, 16, },{19, 3008.12, -5.74271, 13.4472, 16, 16, },{45, 2893.02, -0.277466, 4.50412, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{508.333,992.749},{506.497,992.156},{502.95,990.986},{497.602,989.175},{490.829,986.82},{483.086,984.078},{474.787,981.136},{466.278,978.193},{457.814,975.434},{449.56,973.003},{441.608,970.994},{433.993,969.437},{426.714,968.311},{419.746,967.546},{413.059,967.038},{406.628,966.662},{400.434,966.29},{394.465,965.804},{388.706,965.113},{383.125,964.153},{377.656,962.891},{372.192,961.315},{366.578,959.429},{360.643,957.25},{354.237,954.814},{347.285,952.179},{339.824,949.422},{332.008,946.633},{324.072,943.893},{316.271,941.261},{308.823,938.761},{301.874,936.379},{295.495,934.074},{289.696,931.786},{284.452,929.448},{279.717,926.998},{275.429,924.39},{271.511,921.598},{267.87,918.625},{264.402,915.499},{261.003,912.267},{257.581,908.986},{254.072,905.709},{250.447,902.473},{246.716,899.29},{242.922,896.141},{239.126,892.974},{235.39,889.707},{231.764,886.249},{228.273,882.523},{224.921,878.5},{221.692,874.213},{218.558,869.766},{215.49,865.312},{212.467,861.027},{209.493,857.077},{206.609,853.594},{203.903,850.667},{201.51,848.346},{199.597,846.661},{198.315,845.612},{197.646,845.091},},{{0, 2943.33, 13.9207, -0.0720215, 16, 16, },{24, 2653.56, 7.13443, -1.28183, 16, 16, },{48, 2600.51, 8.15021, -0.811859, 16, 16, },{61, 2577.1, 5.70667, 1.28174, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{1004.55,583.716},{1003.12,585.125},{1000.4,587.825},{996.328,591.849},{991.261,596.872},{985.599,602.52},{979.715,608.486},{973.923,614.545},{968.461,620.572},{963.484,626.522},{959.068,632.403},{955.217,638.246},{951.867,644.084},{948.905,649.943},{946.189,655.833},{943.576,661.753},{940.945,667.689},{938.221,673.618},{935.374,679.508},{932.423,685.323},{929.416,691.027},{926.415,696.579},{923.477,701.941},{920.639,707.074},{917.913,711.949},{915.281,716.563},{912.697,720.953},{910.092,725.203},{907.385,729.436},{904.491,733.8},{901.343,738.433},{897.901,743.441},{894.17,748.877},{890.203,754.728},{886.095,760.928},{881.965,767.361},{877.938,773.896},{874.115,780.406},{870.556,786.792},{867.271,793.003},{864.22,799.025},{861.329,804.878},{858.503,810.59},{855.653,816.187},{852.705,821.677},{849.617,827.054},{846.374,832.3},{842.985,837.396},{839.469,842.328},{835.85,847.088},{832.151,851.676},{828.4,856.089},{824.625,860.324},{820.86,864.371},{817.148,868.216},{813.542,871.829},{810.113,875.165},{806.963,878.151},{804.228,880.687},{802.071,882.651},{800.637,883.94},{799.893,884.602},},{{0, 2835.82, 4.30917, -1.45944, 16, 16, },{28, 3134.25, 0.121582, 3.1517, 16, 16, },{61, 3342.06, 7.3681, -0.235626, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{954.739,703.033},{954.61,705.151},{954.364,709.207},{954.002,715.243},{953.562,722.753},{953.087,731.15},{952.618,739.923},{952.189,748.68},{951.82,757.178},{951.521,765.311},{951.283,773.086},{951.088,780.572},{950.905,787.853},{950.703,794.998},{950.446,802.04},{950.104,808.974},{949.649,815.774},{949.054,822.406},{948.292,828.845},{947.329,835.081},{946.131,841.108},{944.665,846.925},{942.907,852.521},{940.857,857.883},{938.536,862.995},{935.991,867.849},{933.277,872.446},{930.445,876.799},{927.524,880.918},{924.524,884.807},{921.446,888.451},{918.304,891.824},{915.156,894.878},{912.122,897.555},{909.38,899.78},{907.154,901.473},{905.646,902.568},{904.854,903.126},},{{0, 3176.38, -4.39203, 1.59042, 16, 16, },{37, 3471.97, 6.59927, -0.575165, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{932.004,610.255},{930.646,610.687},{928.09,611.563},{924.375,612.986},{919.888,614.972},{915.019,617.523},{910.061,620.627},{905.189,624.254},{900.48,628.349},{895.942,632.832},{891.545,637.598},{887.245,642.522},{882.993,647.465},{878.744,652.281},{874.456,656.832},{870.097,660.995},{865.65,664.678},{861.116,667.833},{856.518,670.468},{851.897,672.646},{847.305,674.483},{842.79,676.129},{838.379,677.747},{834.068,679.478},{829.819,681.419},{825.569,683.609},{821.252,686.031},{816.825,688.624},{812.293,691.306},{807.723,693.98},{803.249,696.548},{799.067,698.903},{795.408,700.933},{792.522,702.521},{790.612,703.568},{789.624,704.108},},{{0, 3020.17, 5.82175, -2.06766, 16, 16, },{23, 3193.02, -6.0668, 8.71896, 16, 16, },{35, 3266.85, 1.18457, 9.21301, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{1015.08,323.199},{1014.56,324.429},{1013.56,326.772},{1012.03,330.228},{1010.05,334.472},{1007.72,339.139},{1005.13,343.924},{1002.36,348.607},{999.446,353.066},{996.411,357.261},{993.257,361.201},{989.978,364.92},{986.572,368.461},{983.051,371.867},{979.441,375.178},{975.79,378.43},{972.162,381.649},{968.626,384.859},{965.248,388.078},{962.072,391.331},{959.111,394.653},{956.339,398.088},{953.698,401.68},{951.099,405.461},{948.442,409.429},{945.629,413.543},{942.574,417.718},{939.216,421.845},{935.519,425.812},{931.475,429.526},{927.104,432.926},{922.45,435.997},{917.573,438.758},{912.547,441.252},{907.449,443.529},{902.345,445.64},{897.287,447.623},{892.312,449.51},{887.438,451.324},{882.676,453.089},{878.039,454.833},{873.548,456.586},{869.234,458.384},{865.137,460.267},{861.296,462.283},{857.744,464.486},{854.501,466.933},{851.583,469.678},{849.001,472.766},{846.777,476.229},{844.948,480.085},{843.566,484.336},{842.701,488.967},{842.428,493.945},{842.825,499.216},{843.958,504.698},{845.866,510.285},{848.557,515.848},{851.99,521.243},{856.082,526.326},{860.713,530.976},{865.743,535.113},{871.03,538.709},{876.448,541.795},{881.891,544.444},{887.273,546.754},{892.524,548.832},{897.578,550.775},{902.371,552.667},{906.843,554.582},{910.942,556.586},{914.634,558.741},{917.913,561.1},{920.809,563.703},{923.382,566.556},{925.715,569.62},{927.884,572.803},{929.935,575.964},{931.858,578.928},{933.582,581.51},{934.986,583.531},{935.942,584.859},{936.447,585.541},},{{0, 3198.8, 9.67142, -4.51221, 16, 16, },{22, 3406.52, 4.49771, -1.01166, 16, 16, },{46, 3821.08, -4.13461, 5.14572, 16, 16, },{74, 3188.07, 1.06842, 4.52484, 16, 16, },{82, 3105.3, 2.69659, 0.343872, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{868.444,252.694},{868.847,254.382},{869.617,257.601},{870.752,262.357},{872.139,268.215},{873.64,274.69},{875.127,281.381},{876.496,288.01},{877.678,294.432},{878.641,300.615},{879.383,306.586},{879.919,312.389},{880.273,318.04},{880.472,323.498},{880.547,328.659},{880.527,333.36},{880.449,337.392},{880.35,340.529},{880.266,342.587},{880.217,343.645},},{{0, 3102.33, -6.75015, 3.59268, 16, 16, },{19, 3562.89, 1.00223, 7.51596, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{653.331,30.3526},{653.458,31.83},{653.733,34.6343},{654.221,38.7583},{654.967,43.827},{656.005,49.446},{657.346,55.3108},{658.962,61.2192},{660.787,67.0623},{662.724,72.7959},{664.658,78.4097},{666.482,83.9049},{668.109,89.2836},{669.485,94.5488},{670.587,99.7115},{671.424,104.799},{672.025,109.856},{672.431,114.943},{672.688,120.119},{672.84,125.432},{672.922,130.903},{672.963,136.529},{672.977,142.286},{672.973,148.139},{672.951,154.051},{672.906,159.984},{672.831,165.899},{672.716,171.74},{672.558,177.426},{672.362,182.83},{672.141,187.779},{671.921,192.055},{671.73,195.405},{671.596,197.618},{671.524,198.761},},{{0, 3073, -1.3501, 12.894, 16, 16, },{17, 3206.35, 5.10464, 4.49533, 16, 16, },{34, 3390.7, 2.42282, 4.20685, 16, 16, },} });
	params.curveConstraints.push_back(gain::curve_constraint{ {{23.1456,404.676},{24.0398,405.75},{25.7463,407.798},{28.2756,410.82},{31.4171,414.521},{34.9478,418.556},{38.7035,422.609},{42.5925,426.424},{46.5911,429.829},{50.7176,432.74},{54.9982,435.149},{59.4368,437.108},{64.0013,438.708},{68.6293,440.06},{73.251,441.268},{77.8177,442.429},{82.3237,443.617},{86.8087,444.892},{91.3405,446.304},{95.9848,447.893},{100.776,449.692},{105.7,451.718},{110.697,453.971},{115.682,456.427},{120.559,459.036},{125.243,461.726},{129.66,464.406},{133.736,466.968},{137.381,469.297},{140.478,471.276},{142.882,472.798},{144.462,473.786},{145.276,474.29},},{{0, 2819, 13.0401, 1.85962, 16, 16, },{17, 3021.53, -1.79321, 4.31149, 16, 16, },{32, 2947.21, 0.661285, 7.12143, 16, 16, },} });

	Mat synth = gain::synthesizeTerrain(test_terrain.heightmap, params);
	imwrite("output/synthesis.png", gain::heightmapToImage(synth));
	gain::terrainWriteASC("output/synthesis.asc", gain::terrain(synth, test_terrain.spacing));
}







static gain::terrain testTerrain;
static Mat color_img;
static bool curveActive = false;
static gain::curve_constraint constraint;


static void onMouse(int event, int x, int y, int, void*) {
	using namespace cv;
	using namespace std;

	const float radius = 20; // constraint radius

	switch (event) {
	case EVENT_LBUTTONDOWN:
		if (!curveActive) {
			constraint = gain::curve_constraint();
		}
		curveActive = true;
		constraint.curveNodes.push_back({int(constraint.path.size())});
		constraint.path.push_back(Vec2f(x, y));
		break;
	case EVENT_RBUTTONDOWN:
		if (curveActive) {
			constraint.curveNodes.push_back({ int(constraint.path.size()) });
			constraint.path.push_back(Vec2f(x, y));

			// smooth
			for (int s = 0; s < 10; s++) {
				const float kern[] = { .006, .061, .242, .383, .242, .061, .006 };
				std::vector<cv::Vec2f> newPath;
				for (int i = 0; i < constraint.path.size(); i++) {
					Vec2f sum = 0;
					float weight = 0;
					for (int k = 0; k < 7; k++) {
						int c = i + k - 3;
						if (c >= 0 && c < constraint.path.size()) {
							sum += constraint.path[c] * kern[k];
							weight += kern[k];
						}
					}

					newPath.push_back(sum / weight);
				}
				constraint.path = newPath;
			}

			// calculate gradients
			for (auto &node : constraint.curveNodes) {
				Vec2f p1 = constraint.path[node.index];
				Vec2f p2, d;
				if (node.index + 1 < constraint.path.size()) {
					p2 = constraint.path[node.index + 1];
					d = p2 - p1;
				}
				else {
					p2 = constraint.path[node.index - 1];
					d = p1 - p2;
				}
				d /= norm(d);

				// sample gradients on either side
				Vec2f left(-d[1], d[0]);
				Vec2f right(d[1], -d[0]);
				float sampleRadius = radius / 2;

				Mat sampler(3, 1, CV_32FC2), sample;
				sampler.at<Vec2f>(0, 0) = p1;
				sampler.at<Vec2f>(1, 0) = left * sampleRadius + p1;
				sampler.at<Vec2f>(2, 0) = right * sampleRadius + p1;
				remap(testTerrain.heightmap, sample, sampler, Mat(), INTER_LINEAR, BORDER_REPLICATE);

				node.height = sample.at<float>(0, 0);
				node.leftGradient = (sample.at<float>(1, 0) - node.height) / sampleRadius;
				node.rightGradient = (sample.at<float>(2, 0) - node.height) / sampleRadius;
				node.leftRadius = radius;
				node.rightRadius = radius;
			}

			// print
			cout << "gain::curve_constraint{{";
			for (auto p : constraint.path) {
				cout << "{" << p[0] << "," << p[1] << "},";
			}
			cout << "},{";
			for (auto n : constraint.curveNodes) {
				cout << "{"
					<< n.index << ", "
					<< n.height << ", "
					<< n.leftGradient << ", "
					<< n.rightGradient << ", "
					<< n.leftRadius << ", "
					<< n.rightRadius << ", "
					<< "},";
			}
			cout << "}}" << endl;

			for (int i = 0; i < int(constraint.path.size()) - 1; i++) {
				line(color_img, Point(constraint.path[i][0], constraint.path[i][1]), Point(constraint.path[i + 1][0], constraint.path[i + 1][1]), Scalar(0, 255, 0), 1, LINE_AA);
			}
			for (auto node : constraint.curveNodes) {
				// center and profile
				Vec2f p = constraint.path[node.index], d;
				circle(color_img, Point(p[0], p[1]), 3, Scalar(0, 255, 0), 1, LINE_AA);
				if (node.index + 1 < constraint.path.size())
					d = constraint.path[node.index + 1] - p;
				else
					d = p - constraint.path[node.index - 1];
				d /= norm(d);
				Vec2f left = p + Vec2f(-d[1], d[0]) * node.leftRadius;
				Vec2f right = p + Vec2f(d[1], -d[0]) * node.rightRadius;

				line(color_img, Point(p[0], p[1]), Point(left[0], left[1]), Scalar(255, 0, 0), 1, LINE_AA);
				line(color_img, Point(p[0], p[1]), Point(right[0], right[1]), Scalar(255, 0, 0), 1, LINE_AA);
			}


		}
		else {
			cout << "sample (" << x << "," << y << ")" << endl;
			gain::constraint_value c = constraint.calculateValue(Vec2f(x, y), 32);
			cout << "distance : " << c.distance<< endl;
			cout << "height   : " << c.height << endl;
			cout << "valid    : " << c.valid << endl;
		}
		curveActive = false;
		break;
	case EVENT_MOUSEMOVE: 
		if (curveActive) {
			static int c = 0;
			if (c++ % 3 == 0) {
				constraint.path.push_back(Vec2f(x, y));
			}
		}
		break;
	default:
		return;
	};


	
	static Mat img;
	color_img.copyTo(img);
	

	for (int i = 0; i < int(constraint.path.size()) - 1; i++) {
		line(img, Point(constraint.path[i][0], constraint.path[i][1]), Point(constraint.path[i+1][0], constraint.path[i + 1][1]), Scalar(0, 0, 255), 1, LINE_AA);
	}
	for (auto node : constraint.curveNodes) {
		Vec2f p = constraint.path[node.index], d;
		circle(img, Point(p[0], p[1]), 3, Scalar(0, 255, 0), 1, LINE_AA);
	}

	imshow("img", img);
}

void constraintCreator() {

	//testTerrain = gain::terrainReadImage("work/res/mount_jackson.png", 0, 255, 1);
	//testTerrain = gain::terrainReadTIFF("work/res/mt_fuji_n035e138.tif");
	//testTerrain = gain::terrainReadTIFF("work/res/mount_jackson_n39_w107_3arc.tif");
	//testTerrain = gain::terrainReadTIFF("work/res/southern_alps_s045e169.tif");
	testTerrain = gain::terrainReadASC("output/target.asc");

	for (int i = 0; i < 10; i++)
		GaussianBlur(testTerrain.heightmap, testTerrain.heightmap, Size(31, 31), 1);


	Mat img = gain::heightmapToImage(testTerrain.heightmap);
	cvtColor(gain::heightmapToImage(testTerrain.heightmap), color_img, cv::COLOR_GRAY2BGR);

	namedWindow("img", WINDOW_AUTOSIZE);
	setMouseCallback("img", onMouse, 0);
	imshow("img", img);
	waitKey(0);
}





void downsampleCreator() {
	gain::terrain test = gain::terrainReadASC("output/jack_target.asc");
	//resize(test.heightmap, test.heightmap, Size(64, 64), 0, 0, INTER_CUBIC);
	//resize(test.heightmap, test.heightmap, Size(1000, 1000), 0, 0, INTER_CUBIC);
	for (int i = 0; i < 250; i++)
		GaussianBlur(test.heightmap, test.heightmap, Size(7, 7), 1);
	gain::terrainWriteASC("output/jack_target_scott.asc", test);
}









void testTerrainOutput() {

	// input terrain
	//gain::terrain test = gain::terrainReadTIFF("work/res/mount_jackson_n39_w107_1arc_v3.tif");

	gain::terrain test, source, target;

	test = gain::terrainReadTIFF("output/mount_jackson_n39_w107_1arc_v3.tif");
	source = gain::terrain(test.heightmap(Range(2600, 3600), Range(1000, 2000)), test.spacing);
	target = gain::terrain(test.heightmap(Range(1600, 2600), Range(1000, 2000)), test.spacing);
	gain::terrainWriteASC("output/jack_full.asc", test);
	gain::terrainWriteASC("output/jack_source.asc", source);
	gain::terrainWriteASC("output/jack_target.asc", target);



	test = gain::terrainReadTIFF("output/moldoveanu_peak_n45_e024_1arc_v3.tif");
	source = gain::terrain(test.heightmap(Range(600, 1600), Range(1600, 2600)), test.spacing);
	target = gain::terrain(test.heightmap(Range(600, 1600), Range(2600, 3600)), test.spacing);
	gain::terrainWriteASC("output/mold_full.asc", test);
	gain::terrainWriteASC("output/mold_source.asc", source);
	gain::terrainWriteASC("output/mold_target.asc", target);


	test = gain::terrainReadTIFF("output/mount_sumbing_s08_e109_110_1arc_v3.tif");
	source = gain::terrain(test.heightmap(Range(900, 1900), Range(3400, 4400)), test.spacing);
	target = gain::terrain(test.heightmap(Range(1300, 2300), Range(4700, 5700)), test.spacing);
	gain::terrainWriteASC("output/sumb_full.asc", test);
	gain::terrainWriteASC("output/sumb_source.asc", source);
	gain::terrainWriteASC("output/sumb_target.asc", target);


	test = gain::terrainReadTIFF("output/mount_woodroffe_s27_e131_1arc_v3.tif");
	source = gain::terrain(test.heightmap(Range(500, 1500), Range(1300, 2300)), test.spacing);
	target = gain::terrain(test.heightmap(Range(500, 1500), Range(2300, 3300)), test.spacing);
	gain::terrainWriteASC("output/wood_full.asc", test);
	gain::terrainWriteASC("output/wood_source.asc", source);
	gain::terrainWriteASC("output/wood_target.asc", target);


	test = gain::terrainReadTIFF("output/al-hadah_n16_e048_1arc_v3.tif");
	source = gain::terrain(test.heightmap(Range(2500, 3500), Range(0, 1000)), test.spacing);
	target = gain::terrain(test.heightmap(Range(2500, 3500), Range(1000, 2000)), test.spacing);
	gain::terrainWriteASC("output/hada_full.asc", test);
	gain::terrainWriteASC("output/hada_source.asc", source);
	gain::terrainWriteASC("output/hada_target.asc", target);
}



void testTerrainInputOutput() {


	gain::terrain test1 = gain::terrainReadTIFF("work/res/mount_jackson_n39_w107_1arc_v3.tif");
	gain::terrainWriteASC("output/testoutput.asc", test1);
	gain::terrain test2 = gain::terrainReadASC("output/testoutput.asc");

	float err = norm(test1.heightmap - test1.heightmap);
	cout << "test1 : (" << test1.heightmap.cols << ", " << test1.heightmap.rows << ") : " << test1.spacing << endl;
	cout << "test2 : (" << test2.heightmap.cols << ", " << test2.heightmap.rows << ") : " << test2.spacing << endl;
	cout << "err " << err << endl;

}









// main program
// 
int main( int argc, char** argv ) {

	//testApprearanceSpace();
	//testK2Patchmatch();

	//constraintCreator();
	//testSynthesis();

	downsampleCreator();
	//testTerrainOutput();
	//testTerrainInputOutput();
}